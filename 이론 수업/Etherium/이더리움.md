rpcapi â†’ ì‚¬ìš©í•  ëª…ë ¹ì–´ ì„¤ì •



```cmd
C:\1blockchain\1etherium\3metacoin Î» truffle develop

truffle(develop)> compile
....
truffle(develop)> migrate
.....
truffle(develop)> var instance=await MetaCoin.deployed()
undefined
truffle(develop)> var accounts = await web3.eth.getAccounts() â† awaitì„ ì‚¬ìš©í•˜ì—¬ ë³€ìˆ˜ ê°’ ì§€ì •ì„ ë¹„ë™ê¸°í•¨ìˆ˜ê°€ ì™„ë£Œë  ë•Œ ê¹Œì§€ ê¸°ë‹¤ë ¤ì¤€ë‹¤.
undefined
truffle(develop)> var balance1 = await instance.getBalance(accounts[0])
undefined
truffle(develop)> balance1
<BN: 2710>
truffle(develop)> accounts
[ '0x1E1284881e3C0698711d8A2c425796ebe8F51cec',
  '0xd4D4224467111d9FE3f51Fdd751B9054fC60541B',
  '0x9c473E1fA362c6A16442571d92f1a0bDeaEaB69a',
  '0xC4dfD7098447660a89371432EFf6287f81b2f6c3',
  '0x13f8D972EDd9fb6Ce3cbf40Ee2a546f621F34F46',
  '0xdfED916aD3f89842729d2753742483d631dBDD48',
  '0x0Bf6C84696Bec3B3999a039A88DE38E92545Bd9E',
  '0x70d00F6a33A449CB2159c2152d158a03a5F71674',
  '0x83D34Bc1EE875394bC4508f46DfE5975E2a4a442',
  '0xc3EA00758eC5e9498D155C75bC4333Abd938F087' ]
truffle(develop)> balance1.toNumber()
10000
truffle(develop)> var balance2 = await instance.getBalance(accounts[1])
undefined
truffle(develop)> balance2.toNumber()
0
truffle(develop)> instance.sendCoin(accounts[1], 1000)
.....
truffle(develop)> balance2.toNumber() â† ë³€ìˆ˜ë¡œ ì„ ì–¸í•´ì¤€ balance2ê°’ì´ê¸° ë•Œë¬¸ì— ê³ ì •ë˜ì–´ ìˆì–´ì„œ ê°±ì‹ (ë‹¤ì‹œ ì„ ì–¸)ì„ í•´ì¤˜ì•¼ ì „ì†¡ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
0
truffle(develop)> var balance2 = await instance.getBalance(accounts[1])
undefined
truffle(develop)> balance2.toNumber()
1000
```

abi: application bytecode interface

```cmd
C:\1blockchain\1etherium\4vote
Î» truffle unbox react
truffle compile
...
truffle migrate --network develop
...
yarn install
...
yarn start
...

cd client/
```



smart contract(ì´ë”ë¦¬ì›€, í•˜ì´í¼ë ˆì €ì—ì„œëŠ” ì²´ì¸ ì½”ë“œ?)ë¥¼ ë‹¤ë¥¸ê³³ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë„ìš°ë¯¸ Stub



truffle

compileì„ í†µí•´ ì»¨íŠ¸ë™íŠ¸solidityíŒŒì¼ì„ ë°”ì´íŠ¸ì½”ë“œí™” í•´ì£¼ê³  migrateë¥¼ í†µí•´ ganacheë¡œ ìƒì„±í•œ ì´ë”ë¦¬ì›€ ë„¤íŠ¸ì›Œí¬ì— ë°°í¬ë¥¼ í•´ì¤€ë‹¤. ì´ë”ë¦¬ì›€ ë„¤íŠ¸ì›Œí¬ì— ë°°í¬ëœ ì»¨íŠ¸ë™íŠ¸ë¥¼ web3(stub)ë¥¼ ì‚¬ìš©í•´ì„œ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•œë‹¤(ì´ í†µì‹ ì— ì‚¬ìš©í•˜ëŠ”ê²Œ rpcì´ê³  ì´ë¥¼ ë„ì™€ì£¼ëŠ” ë„ìš°ë¯¸ ì—­í• ë¡œ skeletonê³¼ stubì´ ìˆë‹¤).



# í•˜ì´í¼ë ˆì ¸

[https://developer.ibm.com/kr/cloud/blockchain/blockchain-special-series/2018/11/11/hyperledger-fabric-architecture-3-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8%EA%B0%80-%EB%A7%8C%EB%93%9C%EB%8A%94-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC/](https://developer.ibm.com/kr/cloud/blockchain/blockchain-special-series/2018/11/11/hyperledger-fabric-architecture-3-ì»´í¬ë„ŒíŠ¸ê°€-ë§Œë“œëŠ”-ë„¤íŠ¸ì›Œí¬/)

ëŠì„ì—†ì´ ì‹ ì›í™•ì¸ì„ í•œë‹¤.(ì •ë§ë¡œ ì´ ë¸”ë¡ì²´ì¸ì˜ ë©¤ë²„ê°€ ë§ëŠ”ì§€) p.49

- ì—¬ê¸°ì— MSPë¥¼ ì‚¬ìš©

ë©¤ë²„ì‰½ - êµ¬ì„± ë°©ë²•, ì±„ë„ë³„ êµ¬ì„± ë°©ë²•, ë©¤ë²„ì‰½ ë ˆë²¨ p.57

Peers - nodeì—­í• (ê°ê°ì˜ ì»´í“¨í„°ë“¤) p.66

Private data - ê°™ì€ ì±„ë„ì— ìˆëŠ” ì¡°ì§ í”¼ì–´ì—ê²Œ ë°ì´í„°ë¥¼ ê³µê°œí•˜ì§€ ì•ŠëŠ” ë°©ë²• p.81

- Privacy - ì±„ë„ë“¤ë¼ë¦¬ëŠ” ì„œë¡œ ì•Œ ìˆ˜ ì—†ë‹¤.

Ledger - ì›ì¥ p.85

ê°œë°œí™˜ê²½ êµ¬ì¶• p.94

íŠœí† ë¦¬ì–¼ (First Network + FabCar) p.105

Marbles Demo - ìì‚° ì´ë™ì— ê´€í•œ ë°ëª¨

CA

- hyperledgerì—ì„œì˜ ì¸ì¦ì€ ë‘ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ê°€ëŠ¥
  1. caë¡œ
  2. cryptogenìœ¼ë¡œ
   - ì´ ê²½ìš° ì±„ë„ì— ì¸ì¦ì •ë³´ê°€ ìˆê¸°ë•Œë¬¸ì— caê°€ ì—†ì–´ë„ ê°€ëŠ¥
  
- ì´ ì‚¬ëŒì´ Ordererê°€ ë§ëŠ”ì§€, Peerê°€ ë§ëŠ”ì§€ í™•ì¸í•´ì£¼ê¸° ìœ„í•œ ì¸ì¦ê¸°ê´€
- CAê°€ Ordererì˜ í™•ì¸ì„ ë§ˆì¹˜ë©´ Ordererì—ì„œëŠ” ì±„ë„ì— ëŒ€í•œ Genesis Blockì´ ìƒì„±ë˜ê³  í”¼ì–´ê°€ ì—°ê²°ë˜ë©´ ê·¸ í”¼ì–´ì— ì „ë‹¬ëœë‹¤. íŠ¸ëœì­ì…˜ì— ëŒ€í•œ Blockì´ ìƒì„±ë˜ê³  ê·¸ Blockì´ ì›ì¥ì— íŒŒì¼ì‹œìŠ¤í…œìœ¼ë¡œ ì €ì¥ì´ë˜ëŠ”ë°, ì´ëŸ¬í•œ íŒŒì¼ì€ ì½ê³  ì“°ëŠ”ë° ì‹œê°„ì´ ì˜¤ë˜ê±¸ë¦¬ê¸° ë•Œë¬¸ì— B2Bì—ì„œëŠ” ë¹ ë¥¸ ë°ì´í„° ì½ê¸°ë¥¼ ìœ„í•œ ìƒíƒœ ì €ì¥ DB(Couch DB)=(World State?)ë¥¼ ì‚¬ìš©í•œë‹¤. ì´ DBë¥¼ Peerë§ˆë‹¤ ì„¤ì¹˜í•´ì•¼ í•˜ëŠ”ê²ƒì€ ë„ˆë¬´ ë²ˆê±°ë¡­ê¸° ë•Œë¬¸ì— IBMì—ì„œ DBì „ìš© ì»´í“¨í„°ë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ë„ë¡ ë§Œë“¤ì—ˆë‹¤. ì´ê²ƒì´ sample networkë“¤ì˜ CouchDB ì»¨í…Œì´ë„ˆì´ë‹¤.

Orderer

- íŠ¸ëœì­ì…˜ í’€ì—ì„œ ìˆœì„œëŒ€ë¡œ ì—¬ëŸ¬ íŠ¸ëœì­ì…˜ì„ ë°›ì•„ì„œ ë¸”ëŸ­ì„ ìƒì„±í•´ì„œ ë§ëŠ” ì±„ë„ì˜ ëª¨ë“  í”¼ì–´ì— ì „ë‹¬í•´ì¤€ë‹¤ (ì±„ë„ë§ˆë‹¤ì˜ íŠ¸ëœì­ì…˜ í’€ì´ ìˆëŠ”ë° ì´ë¥¼ í† í”½(Queue í˜•ì‹)ì´ë¼í•œë‹¤ - í•œ ë¸”ëŸ­ì— ëª‡ê°œì˜ íŠ¸ëœì­ì…˜ì„ ë„£ì„ì§€ ì •í•¨(í•˜ì´í¼ë ˆì €ì—ì„œì˜ í•©ì˜ì—ì„œ)).

- ê¸°ì¡´ì˜ Blockchainì˜ ëª¨ë“  ë…¸ë“œê°€ ë¸”ë¡ì„ ìƒì‚°í•œë‹¤ëŠ” ë¹„íš¨ìœ¨ì ì¸ ê³¼ì •ì„ ì—†ì• ê¸° ìœ„í•´ ë¸”ë¡ì„ ìƒì‚°í•˜ëŠ” íŠ¹ìˆ˜ ë…¸ë“œì¸ Ordererë¥¼ ë§Œë“¤ì—ˆë‹¤.

Ledger êµ¬ì¡°

- W(World State): ìµœì‹  íŠ¸ëœì­ì…˜ë“¤ì˜ ìƒíƒœ ì •ë³´ - ë¹ ë¥´ê²Œ ìµœì‹  ì •ë³´ì— ì—‘ì„¸ìŠ¤í•˜ë ¤ê³  - ì›ì¥ê¹Œì§€ ê°€ì§€ì•Šê³  ì ‘ê·¼ ê°€ëŠ¥. ì‚¬ì‹¤ ì´ DBëŠ” ê°œë…ìƒ Ledgerì•ˆì— í¬í•¨ë˜ì–´ ìˆì§€ë§Œ Peerë§ˆë‹¤ ë³„ë„ë¡œ ì„¤ì¹˜ë˜ì–´ìˆëŠ” DBê°œë…ì´ë‹¤.
- B: ë¸”ë¡ë“¤ì˜ ì²´ì¸

Peer

- Anchor Peer - ë‹¤ë¥¸ ì¡°ì§(Org)ì™€ í†µì‹ í•˜ëŠ” Peer(ë³´í†µ Anchor Peerê°€ Leader Peerì—­í• ë„ í•¨) Anchor Peerë¼ë¦¬ë§Œ í†µì‹ ì„ í•˜ë©´ ë˜ê¸° ë•Œë¬¸ì— ì¡°ì§ê°„ì˜ í†µì‹ ì„ ê°„í¸í™” í•´ì¤Œ

- íŠ¸ëœì­ì…˜ì´ ìƒì„±ë˜ë©´ ë¬´ì¡°ê±´ endorser node peerê°€ ì‹¤í–‰í•´ë³´ê³  ê·¸ ê²€ì¦ê²°ê³¼ë¥¼ cliì—ê²Œ ì „ë‹¬í•´ì£¼ê³  ê²€ì¦ì´ ì œëŒ€ë¡œ ë˜ì—ˆìœ¼ë©´ cliê°€ Ordererì—ê²Œ ì£¼ê³  Ordererê°€ ê·¸ê²ƒì„ ë‹¤ì‹œ ëª¨ë“  Leader Peerë“¤ì—ê²Œ ì¤€ë‹¤. Leader Peerë“¤ì´ ë‹¤ì‹œ íŠ¸ëœì­ì…˜ì„ ê²€ì¦í•´ë³´ê³  ë§ìœ¼ë©´ ì›ì¥ì— ì €ì¥í•˜ê³  ë‹¤ë¥¸ ì¸ì ‘ Peerë“¤(ì´ Peerë“¤ì— ëŒ€í•œ ì •ë³´ê°€ í™•ì‹¤í•˜ê²Œ ì €ì¥ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤)ì—ë„ ì „ë‹¬, ê²€ì¦(ì–´ëŠë…¸ë“œì´ë“ ) í›„ ë³µì‚¬ê°€ ëœê³  ìµœì‹  ìƒíƒœëŠ” CouchDBì— ì €ì¥ëœë‹¤. ì´ëŸ¬í•œ ì „ë‹¬ ì—­í• ì€ Leader Peerë“¤ë§Œ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.
- ê°™ì€ Channelì— ë¬¶ì¸ Peerë“¤ì´ë¼ê³  í• ì§€ë¼ë„ ì›ì¥ê³¼ ë‹¬ë¦¬ Chain CodeëŠ” ë³µì‚¬ë˜ì–´ ê³µìœ ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— clië¡œ í•œ Peerì— Chain Codeë¥¼ installí–ˆë‹¤ê³  í•˜ë”ë¼ë„ ë‹¤ë¥¸ Peerì—ë„ ì§ì ‘ installì„ í•´ì£¼ì–´ì•¼ ê·¸ Peerì—ì„œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤. í•˜ì§€ë§Œ ê·¸ Chain CodeëŠ” ì´ë¯¸ instantiate ê³¼ì •ì„ í†µí•´ Channelì— ë“±ë¡ë˜ì—ˆê¸° ë•Œë¬¸ì— ì´ ê³¼ì •(instantiate)ì€ ìƒëµí•´ë„ ëœë‹¤.

- endorser
  - íŠ¸ëœì­ì…˜ì„ í™•ì¸ = ê±°ë˜ ë³´ì¦ì„ í™•ì¸í•´ì„œ ì‘ë‹µí•´ì¤€ë‹¤.(ìµœì†Œ 1ê°œ ë…¸ë“œ ì´ìƒ. ë‹¤ìˆ˜ì˜(?) endorserë“¤ì´ í‹€ë¦¬ë‹¤ê³  íŒë‹¨í•˜ë©´ ì˜ëª»ëœ ê±°ë˜ë¡œ íŒë‹¨)
  - ê±°ë˜ë¥¼ ì‹¤í–‰í•˜ëŠ” ë…¸ë“œ
- commiter
  - ì›ì¥ ê°±ì‹ ì„ í•´ì¤Œ(ëª¨ë“  Peerê°€ commiterê°€ ë˜ì–´ì•¼ í•œë‹¤).
  - ê±°ë˜ë¥¼ í™•ì •í•´ì„œ ë¸”ë¡ì²´ì¸ì— ì €ì¥í•˜ê²Œ í•˜ëŠ” ë…¸ë“œ
- blockchain
- peer ëª…ë ¹ì–´ ì¤‘
  - queryëŠ” world stateì— ì ‘ê·¼í•˜ëŠ” ê²ƒì´ë¼ ê¸°ë¡ì´ ë‚¨ì§€ ì•ŠëŠ”ë‹¤
  - invokeëŠ” ì¡°íšŒì´ë“  ìˆ˜ì •ì´ë“  ì›ì¥ì— ì ‘ê·¼(transactionìœ¼ë¡œ ë™ì‘)í•˜ëŠ” ê²ƒì´ë¼ ê¸°ë¡ì´ ë‚¨ëŠ”ë‹¤.



cli> peer chaincode install -n jes -v 1.0 -p github.com/sacc (ğŸ¡ºjesë¼ëŠ” ì´ë¦„ìœ¼ë¡œ saccë¥¼ ì„¤ì¹˜í•œë‹¤)

ì´ ë¶€ë¶„ì—ì„œ ì²´ì¸ì½”ë“œë¥¼ ì„¤ì¹˜í•œ ê²ƒì´ë‹¤. ê³µìœ ë³¼ë¥¨ì¸ ~/HLF/fabric-samples/chaincodeì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ì²´ì¸ì½”ë“œ ê°œë°œìëŠ” SHIM API(nodeì—ì„œ 'fabric-shim')ë¥¼ ì•Œì•„ì•¼í•œë‹¤.

### í•˜ì´í¼ë ˆì ¸ íë¦„

1. cli(Clientì—­í• )ê°€ peerì— tx ìš”ì²­
2. peerê°€ txì„ ì‹¤í–‰í•´ë³´ê³  
3. ê·¸ ê²€ì¦ ê²°ê³¼(Endorsement)ë¥¼ clientì—ê²Œ ë‹¤ì‹œ ì¤Œ.
4. cli(Clientì—­í• )ê°€ txë¥¼ ordererì— boxing í•´ë‹¬ë¼ ìš”ì²­
5. ordererê°€ í•©ì˜ì•Œê³ ë¦¬ì¦˜ì— ì˜í•´ ë°°ì¹˜ë¡œ tx ìˆœì°¨ ì •ë¦¬
6. orderer ë°•ì‹±í›„ peerì— ì „ë‹¬
7. peerì—ì„œ tx ê²€ì¦ ë° ì›ì¥ ì €ì¥(commit)
8. ì›ì¥ ì—…ë°ì´íŠ¸ í›„ world stateì— ì €ì¥(CouchDB)

**(ëª¨ë“  ê³¼ì •ì—ì„œ ì‹ ì›í™•ì¸ CA)**

install ì€ peerì— chaincodeë¥¼ ì„¤ì¹˜í•  ë¿ ordererê°€ ì¸ì‹í•˜ì§€ ëª»í•œë‹¤. instantiateë¥¼ í•´ì•¼ ì±„ë„ì— ì—°ê²°ë˜ê³  ordererê°€ ì•Œ ìˆ˜ ìˆë‹¤.

ì›ì¥ fileì¸ blockfileì€ ì±„ë„ ë‹¹ í•˜ë‚˜ë§Œ ìƒì„±ëœë‹¤. ê·¸ë¦¼ìƒ C1ì˜ L1. ê°™ì€ ì±„ë„ì— ìƒˆë¡œìš´ chaincodeê°€ ì„¤ì¹˜ë˜ì–´ë„ ì›ì¥ì€ í•˜ë‚˜ë§Œ ìƒì„±ëœë‹¤.

ì‹¤ìŠµê³¼ì •ì—ì„œ ì›”ë ›ì„ ìƒì„±í•˜ì—¬ ê·¸ê³³ì— ìˆëŠ” Private Keyë¥¼ ì´ìš©í•´ ì‹ ì›í™•ì¸ì„ í•œë‹¤.



### ì‹¤ì „ì••ì¶• ëª…ë ¹ì–´

```bash
ubuntu@ubuntu-jes:~/HLF/fabric-samples/basic-network$ ./start.sh
ubuntu@ubuntu-jes:~/HLF/fabric-samples/basic-network$ sudo docker ps -a
ubuntu@ubuntu-jes:~/HLF/fabric-samples/basic-network$ docker exec -it cli bash
cli>peer chaincode install -n jes -v 1.0 -p github.com/sacc
cli>peer chaincode instantiate -n jes -v 1.0 -c â€˜{â€œArgsâ€:[â€œaâ€,â€10â€]}â€™ -C mychannel
cli>peer chaincode query -n jes -c â€˜{â€œArgsâ€:[â€œgetâ€,â€aâ€]}â€™ -C mychannel
cli>peer chaincode invoke -n jes -c â€˜{â€œArgsâ€:[â€œsetâ€,â€aâ€,â€200â€]}â€™ -C mychannel
cli>peer chaincode query -n jes -c â€˜{â€œArgsâ€:[â€œgetâ€,â€aâ€]}â€™ -C mychannel
```

### ê´€ë ¨ íŒŒì¼

`start.sh`, `docker-compose.yml`, `configtx.yaml(&ëŠ” ì •ì˜, *ëŠ” ì°¸ì¡°)`, `crypto-config.yaml`



### First Network script

`eyfn.sh`ì˜ ì¼ë¶€

```sh
if [ "${MODE}" == "up" ]; then
  networkUp
elif [ "${MODE}" == "down" ]; then ## Clear the network
  networkDown
elif [ "${MODE}" == "generate" ]; then ## Generate Artifacts
  generateCerts
  replacePrivateKey
  generateChannelArtifacts
elif [ "${MODE}" == "restart" ]; then ## Restart the network
  networkDown
  networkUp
elif [ "${MODE}" == "upgrade" ]; then ## Upgrade the network from version 1.2.x to 1.3.x
  upgradeNetwork
else
  printHelp
  exit 1
fi

# Generates Org certs using cryptogen tool
function generateCerts() {
  which cryptogen
  if [ "$?" -ne 0 ]; then
    echo "cryptogen tool not found. exiting"
    exit 1
  fi
  echo
  echo "##########################################################"
  echo "##### Generate certificates using cryptogen tool #########"
  echo "##########################################################"

  if [ -d "crypto-config" ]; then
    rm -Rf crypto-config
  fi
  set -x
  cryptogen generate --config=./crypto-config.yaml
  res=$?
  set +x
  if [ $res -ne 0 ]; then
    echo "Failed to generate certificates..."
    exit 1
  fi
  echo
  echo "Generate CCP files for Org1 and Org2"
  ./ccp-generate.sh
}

# Using docker-compose-e2e-template.yaml, replace constants with private key file names
# generated by the cryptogen tool and output a docker-compose.yaml specific to this
# configuration
function replacePrivateKey() {
  # sed on MacOSX does not support -i flag with a null extension. We will use
  # 't' for our back-up's extension and delete it at the end of the function
  ARCH=$(uname -s | grep Darwin)
  if [ "$ARCH" == "Darwin" ]; then
    OPTS="-it"
  else
    OPTS="-i"
  fi

  # Copy the template to the file that will be modified to add the private key
  cp docker-compose-e2e-template.yaml docker-compose-e2e.yaml

  # The next steps will replace the template's contents with the
  # actual values of the private key file names for the two CAs.
  CURRENT_DIR=$PWD
  cd crypto-config/peerOrganizations/org1.example.com/ca/
  PRIV_KEY=$(ls *_sk)
  cd "$CURRENT_DIR"
  sed $OPTS "s/CA1_PRIVATE_KEY/${PRIV_KEY}/g" docker-compose-e2e.yaml
  cd crypto-config/peerOrganizations/org2.example.com/ca/
  PRIV_KEY=$(ls *_sk)
  cd "$CURRENT_DIR"
  sed $OPTS "s/CA2_PRIVATE_KEY/${PRIV_KEY}/g" docker-compose-e2e.yaml
  # If MacOSX, remove the temporary backup of the docker-compose file
  if [ "$ARCH" == "Darwin" ]; then
    rm docker-compose-e2e.yamlt
  fi
}

# Generate orderer genesis block, channel configuration transaction and
# anchor peer update transactions
function generateChannelArtifacts() {
  which configtxgen
  if [ "$?" -ne 0 ]; then
    echo "configtxgen tool not found. exiting"
    exit 1
  fi

  echo "##########################################################"
  echo "#########  Generating Orderer Genesis block ##############"
  echo "##########################################################"
  # Note: For some unknown reason (at least for now) the block file can't be
  # named orderer.genesis.block or the orderer will fail to launch!
  echo "CONSENSUS_TYPE="$CONSENSUS_TYPE
  set -x
  if [ "$CONSENSUS_TYPE" == "solo" ]; then
    configtxgen -profile TwoOrgsOrdererGenesis -channelID $SYS_CHANNEL -outputBlock ./channel-artifacts/genesis.block
  elif [ "$CONSENSUS_TYPE" == "kafka" ]; then
    configtxgen -profile SampleDevModeKafka -channelID $SYS_CHANNEL -outputBlock ./channel-artifacts/genesis.block
  elif [ "$CONSENSUS_TYPE" == "etcdraft" ]; then
    configtxgen -profile SampleMultiNodeEtcdRaft -channelID $SYS_CHANNEL -outputBlock ./channel-artifacts/genesis.block
  else
    set +x
    echo "unrecognized CONSESUS_TYPE='$CONSENSUS_TYPE'. exiting"
    exit 1
  fi
  res=$?
  set +x
  if [ $res -ne 0 ]; then
    echo "Failed to generate orderer genesis block..."
    exit 1
  fi
  echo
  echo "#################################################################"
  echo "### Generating channel configuration transaction 'channel.tx' ###"
  echo "#################################################################"
  set -x
  configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID $CHANNEL_NAME
  res=$?
  set +x
  if [ $res -ne 0 ]; then
    echo "Failed to generate channel configuration transaction..."
    exit 1
  fi

  echo
  echo "#################################################################"
  echo "#######    Generating anchor peer update for Org1MSP   ##########"
  echo "#################################################################"
  set -x
  configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org1MSP
  res=$?
  set +x
  if [ $res -ne 0 ]; then
    echo "Failed to generate anchor peer update for Org1MSP..."
    exit 1
  fi

  echo
  echo "#################################################################"
  echo "#######    Generating anchor peer update for Org2MSP   ##########"
  echo "#################################################################"
  set -x
  configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate \
    ./channel-artifacts/Org2MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org2MSP
  res=$?
  set +x
  if [ $res -ne 0 ]; then
    echo "Failed to generate anchor peer update for Org2MSP..."
    exit 1
  fi
  echo
}

# Generate the needed certificates, the genesis block and start the network.
function networkUp() {
  checkPrereqs
  # generate artifacts if they don't exist
  if [ ! -d "crypto-config" ]; then
    generateCerts
    replacePrivateKey
    generateChannelArtifacts
  fi
  COMPOSE_FILES="-f ${COMPOSE_FILE}"
  if [ "${CERTIFICATE_AUTHORITIES}" == "true" ]; then
    COMPOSE_FILES="${COMPOSE_FILES} -f ${COMPOSE_FILE_CA}"
    export BYFN_CA1_PRIVATE_KEY=$(cd crypto-config/peerOrganizations/org1.example.com/ca && ls *_sk)
    export BYFN_CA2_PRIVATE_KEY=$(cd crypto-config/peerOrganizations/org2.example.com/ca && ls *_sk)
  fi
  if [ "${CONSENSUS_TYPE}" == "kafka" ]; then
    COMPOSE_FILES="${COMPOSE_FILES} -f ${COMPOSE_FILE_KAFKA}"
  elif [ "${CONSENSUS_TYPE}" == "etcdraft" ]; then
    COMPOSE_FILES="${COMPOSE_FILES} -f ${COMPOSE_FILE_RAFT2}"
  fi
  if [ "${IF_COUCHDB}" == "couchdb" ]; then
    COMPOSE_FILES="${COMPOSE_FILES} -f ${COMPOSE_FILE_COUCH}"
  fi
  IMAGE_TAG=$IMAGETAG docker-compose ${COMPOSE_FILES} up -d 2>&1
  docker ps -a
  if [ $? -ne 0 ]; then
    echo "ERROR !!!! Unable to start network"
    exit 1
  fi

  if [ "$CONSENSUS_TYPE" == "kafka" ]; then
    sleep 1
    echo "Sleeping 10s to allow $CONSENSUS_TYPE cluster to complete booting"
    sleep 9
  fi

  if [ "$CONSENSUS_TYPE" == "etcdraft" ]; then
    sleep 1
    echo "Sleeping 15s to allow $CONSENSUS_TYPE cluster to complete booting"
    sleep 14
  fi

  # now run the end to end script
  docker exec cli scripts/script.sh $CHANNEL_NAME $CLI_DELAY $LANGUAGE $CLI_TIMEOUT $VERBOSE $NO_CHAINCODE
  if [ $? -ne 0 ]; then
    echo "ERROR !!!! Test failed"
    exit 1
  fi
}
```

networkUp funtionì˜ ë§ˆì§€ë§‰ì— cli ì— ê³µìœ ë³¼ë¥¨ì„ ì‚¬ìš©í•´ ì œê³µí•œ script.sh íŒŒì¼ì„ ì‹¤í–‰í•˜ë¼ í•œë‹¤.

`script.sh`

```sh
#!/bin/bash

echo
echo " ____    _____      _      ____    _____ "
echo "/ ___|  |_   _|    / \    |  _ \  |_   _|"
echo "\___ \    | |     / _ \   | |_) |   | |  "
echo " ___) |   | |    / ___ \  |  _ <    | |  "
echo "|____/    |_|   /_/   \_\ |_| \_\   |_|  "
echo
echo "Build your first network (BYFN) end-to-end test"
echo
CHANNEL_NAME="$1"
DELAY="$2"
LANGUAGE="$3"
TIMEOUT="$4"
VERBOSE="$5"
NO_CHAINCODE="$6"
: ${CHANNEL_NAME:="mychannel"}
: ${DELAY:="3"}
: ${LANGUAGE:="golang"}
: ${TIMEOUT:="10"}
: ${VERBOSE:="false"}
: ${NO_CHAINCODE:="false"}
LANGUAGE=`echo "$LANGUAGE" | tr [:upper:] [:lower:]`
COUNTER=1
MAX_RETRY=10

CC_SRC_PATH="github.com/chaincode/chaincode_example02/go/"
if [ "$LANGUAGE" = "node" ]; then
	CC_SRC_PATH="/opt/gopath/src/github.com/chaincode/chaincode_example02/node/"
fi

if [ "$LANGUAGE" = "java" ]; then
	CC_SRC_PATH="/opt/gopath/src/github.com/chaincode/chaincode_example02/java/"
fi

echo "Channel name : "$CHANNEL_NAME

# import utils
. scripts/utils.sh

createChannel() {
	setGlobals 0 1

	if [ -z "$CORE_PEER_TLS_ENABLED" -o "$CORE_PEER_TLS_ENABLED" = "false" ]; then
                set -x
		peer channel create -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/channel.tx >&log.txt
		res=$?
                set +x
	else
				set -x
		peer channel create -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/channel.tx --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA >&log.txt
		res=$?
				set +x
	fi
	cat log.txt
	verifyResult $res "Channel creation failed"
	echo "===================== Channel '$CHANNEL_NAME' created ===================== "
	echo
}

joinChannel () {
	for org in 1 2; do
	    for peer in 0 1; do
		joinChannelWithRetry $peer $org
		echo "===================== peer${peer}.org${org} joined channel '$CHANNEL_NAME' ===================== "
		sleep $DELAY
		echo
	    done
	done
}

## Create channel
echo "Creating channel..."
createChannel

## Join all the peers to the channel
echo "Having all peers join the channel..."
joinChannel

## Set the anchor peers for each org in the channel
echo "Updating anchor peers for org1..."
updateAnchorPeers 0 1
echo "Updating anchor peers for org2..."
updateAnchorPeers 0 2

if [ "${NO_CHAINCODE}" != "true" ]; then

	## Install chaincode on peer0.org1 and peer0.org2
	echo "Installing chaincode on peer0.org1..."
	installChaincode 0 1
	echo "Install chaincode on peer0.org2..."
	installChaincode 0 2

	# Instantiate chaincode on peer0.org2
	echo "Instantiating chaincode on peer0.org2..."
	instantiateChaincode 0 2

	# Query chaincode on peer0.org1
	echo "Querying chaincode on peer0.org1..."
	chaincodeQuery 0 1 100

	# Invoke chaincode on peer0.org1 and peer0.org2
	echo "Sending invoke transaction on peer0.org1 peer0.org2..."
	chaincodeInvoke 0 1 0 2
	
	## Install chaincode on peer1.org2
	echo "Installing chaincode on peer1.org2..."
	installChaincode 1 2

	# Query on chaincode on peer1.org2, check if the result is 90
	echo "Querying chaincode on peer1.org2..."
	chaincodeQuery 1 2 90
	
fi

echo
echo "========= All GOOD, BYFN execution completed =========== "
echo

echo
echo " _____   _   _   ____   "
echo "| ____| | \ | | |  _ \  "
echo "|  _|   |  \| | | | | | "
echo "| |___  | |\  | | |_| | "
echo "|_____| |_| \_| |____/  "
echo

exit 0
```

`script.sh`ì—ì„œ ë¶ˆëŸ¬ì˜¨ `utils.sh`

```sh
#
# Copyright IBM Corp All Rights Reserved
#
# SPDX-License-Identifier: Apache-2.0
#

# This is a collection of bash functions used by different scripts

ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
PEER0_ORG1_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
PEER0_ORG2_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
PEER0_ORG3_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/ca.crt

# verify the result of the end-to-end test
verifyResult() {
  if [ $1 -ne 0 ]; then
    echo "!!!!!!!!!!!!!!! "$2" !!!!!!!!!!!!!!!!"
    echo "========= ERROR !!! FAILED to execute End-2-End Scenario ==========="
    echo
    exit 1
  fi
}

# Set OrdererOrg.Admin globals
setOrdererGlobals() {
  CORE_PEER_LOCALMSPID="OrdererMSP"
  CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
  CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/users/Admin@example.com/msp
}

setGlobals() {
  PEER=$1
  ORG=$2
  if [ $ORG -eq 1 ]; then
    CORE_PEER_LOCALMSPID="Org1MSP"
    CORE_PEER_TLS_ROOTCERT_FILE=$PEER0_ORG1_CA
    CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
    if [ $PEER -eq 0 ]; then
      CORE_PEER_ADDRESS=peer0.org1.example.com:7051
    else
      CORE_PEER_ADDRESS=peer1.org1.example.com:8051
    fi
  elif [ $ORG -eq 2 ]; then
    CORE_PEER_LOCALMSPID="Org2MSP"
    CORE_PEER_TLS_ROOTCERT_FILE=$PEER0_ORG2_CA
    CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
    if [ $PEER -eq 0 ]; then
      CORE_PEER_ADDRESS=peer0.org2.example.com:9051
    else
      CORE_PEER_ADDRESS=peer1.org2.example.com:10051
    fi

  elif [ $ORG -eq 3 ]; then
    CORE_PEER_LOCALMSPID="Org3MSP"
    CORE_PEER_TLS_ROOTCERT_FILE=$PEER0_ORG3_CA
    CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/users/Admin@org3.example.com/msp
    if [ $PEER -eq 0 ]; then
      CORE_PEER_ADDRESS=peer0.org3.example.com:11051
    else
      CORE_PEER_ADDRESS=peer1.org3.example.com:12051
    fi
  else
    echo "================== ERROR !!! ORG Unknown =================="
  fi

  if [ "$VERBOSE" == "true" ]; then
    env | grep CORE
  fi
}

updateAnchorPeers() {
  PEER=$1
  ORG=$2
  setGlobals $PEER $ORG

  if [ -z "$CORE_PEER_TLS_ENABLED" -o "$CORE_PEER_TLS_ENABLED" = "false" ]; then
    set -x
    peer channel update -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/${CORE_PEER_LOCALMSPID}anchors.tx >&log.txt
    res=$?
    set +x
  else
    set -x
    peer channel update -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/${CORE_PEER_LOCALMSPID}anchors.tx --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA >&log.txt
    res=$?
    set +x
  fi
  cat log.txt
  verifyResult $res "Anchor peer update failed"
  echo "===================== Anchor peers updated for org '$CORE_PEER_LOCALMSPID' on channel '$CHANNEL_NAME' ===================== "
  sleep $DELAY
  echo
}

## Sometimes Join takes time hence RETRY at least 5 times
joinChannelWithRetry() {
  PEER=$1
  ORG=$2
  setGlobals $PEER $ORG

  set -x
  peer channel join -b $CHANNEL_NAME.block >&log.txt
  res=$?
  set +x
  cat log.txt
  if [ $res -ne 0 -a $COUNTER -lt $MAX_RETRY ]; then
    COUNTER=$(expr $COUNTER + 1)
    echo "peer${PEER}.org${ORG} failed to join the channel, Retry after $DELAY seconds"
    sleep $DELAY
    joinChannelWithRetry $PEER $ORG
  else
    COUNTER=1
  fi
  verifyResult $res "After $MAX_RETRY attempts, peer${PEER}.org${ORG} has failed to join channel '$CHANNEL_NAME' "
}

installChaincode() {
  PEER=$1
  ORG=$2
  setGlobals $PEER $ORG
  VERSION=${3:-1.0}
  set -x
  peer chaincode install -n mycc -v ${VERSION} -l ${LANGUAGE} -p ${CC_SRC_PATH} >&log.txt
  res=$?
  set +x
  cat log.txt
  verifyResult $res "Chaincode installation on peer${PEER}.org${ORG} has failed"
  echo "===================== Chaincode is installed on peer${PEER}.org${ORG} ===================== "
  echo
}

instantiateChaincode() {
  PEER=$1
  ORG=$2
  setGlobals $PEER $ORG
  VERSION=${3:-1.0}

  # while 'peer chaincode' command can get the orderer endpoint from the peer
  # (if join was successful), let's supply it directly as we know it using
  # the "-o" option
  if [ -z "$CORE_PEER_TLS_ENABLED" -o "$CORE_PEER_TLS_ENABLED" = "false" ]; then
    set -x
    peer chaincode instantiate -o orderer.example.com:7050 -C $CHANNEL_NAME -n mycc -l ${LANGUAGE} -v ${VERSION} -c '{"Args":["init","a","100","b","200"]}' -P "AND ('Org1MSP.peer','Org2MSP.peer')" >&log.txt
    res=$?
    set +x
  else
    set -x
    peer chaincode instantiate -o orderer.example.com:7050 --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA -C $CHANNEL_NAME -n mycc -l ${LANGUAGE} -v 1.0 -c '{"Args":["init","a","100","b","200"]}' -P "AND ('Org1MSP.peer','Org2MSP.peer')" >&log.txt
    res=$?
    set +x
  fi
  cat log.txt
  verifyResult $res "Chaincode instantiation on peer${PEER}.org${ORG} on channel '$CHANNEL_NAME' failed"
  echo "===================== Chaincode is instantiated on peer${PEER}.org${ORG} on channel '$CHANNEL_NAME' ===================== "
  echo
}

upgradeChaincode() {
  PEER=$1
  ORG=$2
  setGlobals $PEER $ORG

  set -x
  peer chaincode upgrade -o orderer.example.com:7050 --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA -C $CHANNEL_NAME -n mycc -v 2.0 -c '{"Args":["init","a","90","b","210"]}' -P "AND ('Org1MSP.peer','Org2MSP.peer','Org3MSP.peer')"
  res=$?
  set +x
  cat log.txt
  verifyResult $res "Chaincode upgrade on peer${PEER}.org${ORG} has failed"
  echo "===================== Chaincode is upgraded on peer${PEER}.org${ORG} on channel '$CHANNEL_NAME' ===================== "
  echo
}

chaincodeQuery() {
  PEER=$1
  ORG=$2
  setGlobals $PEER $ORG
  EXPECTED_RESULT=$3
  echo "===================== Querying on peer${PEER}.org${ORG} on channel '$CHANNEL_NAME'... ===================== "
  local rc=1
  local starttime=$(date +%s)

  # continue to poll
  # we either get a successful response, or reach TIMEOUT
  while
    test "$(($(date +%s) - starttime))" -lt "$TIMEOUT" -a $rc -ne 0
  do
    sleep $DELAY
    echo "Attempting to Query peer${PEER}.org${ORG} ...$(($(date +%s) - starttime)) secs"
    set -x
    peer chaincode query -C $CHANNEL_NAME -n mycc -c '{"Args":["query","a"]}' >&log.txt
    res=$?
    set +x
    test $res -eq 0 && VALUE=$(cat log.txt | awk '/Query Result/ {print $NF}')
    test "$VALUE" = "$EXPECTED_RESULT" && let rc=0
    # removed the string "Query Result" from peer chaincode query command
    # result. as a result, have to support both options until the change
    # is merged.
    test $rc -ne 0 && VALUE=$(cat log.txt | egrep '^[0-9]+$')
    test "$VALUE" = "$EXPECTED_RESULT" && let rc=0
  done
  echo
  cat log.txt
  if test $rc -eq 0; then
    echo "===================== Query successful on peer${PEER}.org${ORG} on channel '$CHANNEL_NAME' ===================== "
  else
    echo "!!!!!!!!!!!!!!! Query result on peer${PEER}.org${ORG} is INVALID !!!!!!!!!!!!!!!!"
    echo "================== ERROR !!! FAILED to execute End-2-End Scenario =================="
    echo
    exit 1
  fi
}

# fetchChannelConfig <channel_id> <output_json>
# Writes the current channel config for a given channel to a JSON file
fetchChannelConfig() {
  CHANNEL=$1
  OUTPUT=$2

  setOrdererGlobals

  echo "Fetching the most recent configuration block for the channel"
  if [ -z "$CORE_PEER_TLS_ENABLED" -o "$CORE_PEER_TLS_ENABLED" = "false" ]; then
    set -x
    peer channel fetch config config_block.pb -o orderer.example.com:7050 -c $CHANNEL --cafile $ORDERER_CA
    set +x
  else
    set -x
    peer channel fetch config config_block.pb -o orderer.example.com:7050 -c $CHANNEL --tls --cafile $ORDERER_CA
    set +x
  fi

  echo "Decoding config block to JSON and isolating config to ${OUTPUT}"
  set -x
  configtxlator proto_decode --input config_block.pb --type common.Block | jq .data.data[0].payload.data.config >"${OUTPUT}"
  set +x
}

# signConfigtxAsPeerOrg <org> <configtx.pb>
# Set the peerOrg admin of an org and signing the config update
signConfigtxAsPeerOrg() {
  PEERORG=$1
  TX=$2
  setGlobals 0 $PEERORG
  set -x
  peer channel signconfigtx -f "${TX}"
  set +x
}

# createConfigUpdate <channel_id> <original_config.json> <modified_config.json> <output.pb>
# Takes an original and modified config, and produces the config update tx
# which transitions between the two
createConfigUpdate() {
  CHANNEL=$1
  ORIGINAL=$2
  MODIFIED=$3
  OUTPUT=$4

  set -x
  configtxlator proto_encode --input "${ORIGINAL}" --type common.Config >original_config.pb
  configtxlator proto_encode --input "${MODIFIED}" --type common.Config >modified_config.pb
  configtxlator compute_update --channel_id "${CHANNEL}" --original original_config.pb --updated modified_config.pb >config_update.pb
  configtxlator proto_decode --input config_update.pb --type common.ConfigUpdate >config_update.json
  echo '{"payload":{"header":{"channel_header":{"channel_id":"'$CHANNEL'", "type":2}},"data":{"config_update":'$(cat config_update.json)'}}}' | jq . >config_update_in_envelope.json
  configtxlator proto_encode --input config_update_in_envelope.json --type common.Envelope >"${OUTPUT}"
  set +x
}

# parsePeerConnectionParameters $@
# Helper function that takes the parameters from a chaincode operation
# (e.g. invoke, query, instantiate) and checks for an even number of
# peers and associated org, then sets $PEER_CONN_PARMS and $PEERS
parsePeerConnectionParameters() {
  # check for uneven number of peer and org parameters
  if [ $(($# % 2)) -ne 0 ]; then
    exit 1
  fi

  PEER_CONN_PARMS=""
  PEERS=""
  while [ "$#" -gt 0 ]; do
    setGlobals $1 $2
    PEER="peer$1.org$2"
    PEERS="$PEERS $PEER"
    PEER_CONN_PARMS="$PEER_CONN_PARMS --peerAddresses $CORE_PEER_ADDRESS"
    if [ -z "$CORE_PEER_TLS_ENABLED" -o "$CORE_PEER_TLS_ENABLED" = "true" ]; then
      TLSINFO=$(eval echo "--tlsRootCertFiles \$PEER$1_ORG$2_CA")
      PEER_CONN_PARMS="$PEER_CONN_PARMS $TLSINFO"
    fi
    # shift by two to get the next pair of peer/org parameters
    shift
    shift
  done
  # remove leading space for output
  PEERS="$(echo -e "$PEERS" | sed -e 's/^[[:space:]]*//')"
}

# chaincodeInvoke <peer> <org> ...
# Accepts as many peer/org pairs as desired and requests endorsement from each
chaincodeInvoke() {
  parsePeerConnectionParameters $@
  res=$?
  verifyResult $res "Invoke transaction failed on channel '$CHANNEL_NAME' due to uneven number of peer and org parameters "

  # while 'peer chaincode' command can get the orderer endpoint from the
  # peer (if join was successful), let's supply it directly as we know
  # it using the "-o" option
  if [ -z "$CORE_PEER_TLS_ENABLED" -o "$CORE_PEER_TLS_ENABLED" = "false" ]; then
    set -x
    peer chaincode invoke -o orderer.example.com:7050 -C $CHANNEL_NAME -n mycc $PEER_CONN_PARMS -c '{"Args":["invoke","a","b","10"]}' >&log.txt
    res=$?
    set +x
  else
    set -x
    peer chaincode invoke -o orderer.example.com:7050 --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA -C $CHANNEL_NAME -n mycc $PEER_CONN_PARMS -c '{"Args":["invoke","a","b","10"]}' >&log.txt
    res=$?
    set +x
  fi
  cat log.txt
  verifyResult $res "Invoke execution on $PEERS failed "
  echo "===================== Invoke transaction successful on $PEERS on channel '$CHANNEL_NAME' ===================== "
  echo
}
```









`crypto-config.yaml`

```yaml
# Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

# ---------------------------------------------------------------------------
# "OrdererOrgs" - Definition of organizations managing orderer nodes
# ---------------------------------------------------------------------------
OrdererOrgs:
  # ---------------------------------------------------------------------------
  # Orderer
  # ---------------------------------------------------------------------------
  - Name: Orderer
    Domain: example.com
    EnableNodeOUs: true
    # ---------------------------------------------------------------------------
    # "Specs" - See PeerOrgs below for complete description
    # ---------------------------------------------------------------------------
    Specs:
      - Hostname: orderer
      - Hostname: orderer2
      - Hostname: orderer3
      - Hostname: orderer4
      - Hostname: orderer5
	# ì´ìª½ key 5ê°œ ìƒì„±
# ---------------------------------------------------------------------------
# "PeerOrgs" - Definition of organizations managing peer nodes
# ---------------------------------------------------------------------------
PeerOrgs:
  # ---------------------------------------------------------------------------
  # Org1
  # ---------------------------------------------------------------------------
  - Name: Org1
    Domain: org1.example.com
    EnableNodeOUs: true
    # ---------------------------------------------------------------------------
    # "Specs"
    # ---------------------------------------------------------------------------
    # Uncomment this section to enable the explicit definition of hosts in your
    # configuration.  Most users will want to use Template, below
    #
    # Specs is an array of Spec entries.  Each Spec entry consists of two fields:
    #   - Hostname:   (Required) The desired hostname, sans the domain.
    #   - CommonName: (Optional) Specifies the template or explicit override for
    #                 the CN.  By default, this is the template:
    #
    #                              "{{.Hostname}}.{{.Domain}}"
    #
    #                 which obtains its values from the Spec.Hostname and
    #                 Org.Domain, respectively.
    # ---------------------------------------------------------------------------
    # Specs:
    #   - Hostname: foo # implicitly "foo.org1.example.com"
    #     CommonName: foo27.org5.example.com # overrides Hostname-based FQDN set above
    #   - Hostname: bar
    #   - Hostname: baz
    # ---------------------------------------------------------------------------
    # "Template"
    # ---------------------------------------------------------------------------
    # Allows for the definition of 1 or more hosts that are created sequentially
    # from a template. By default, this looks like "peer%d" from 0 to Count-1.
    # You may override the number of nodes (Count), the starting index (Start)
    # or the template used to construct the name (Hostname).
    #
    # Note: Template and Specs are not mutually exclusive.  You may define both
    # sections and the aggregate nodes will be created for you.  Take care with
    # name collisions
    # ---------------------------------------------------------------------------
    Template:
      Count: 2
      # ì´ìª½ì´ í”¼ì–´ì˜ ìˆ«ì
      # Start: 5
      # Hostname: {{.Prefix}}{{.Index}} # default
    # ---------------------------------------------------------------------------
    # "Users"
    # ---------------------------------------------------------------------------
    # Count: The number of user accounts _in addition_ to Admin
    # ---------------------------------------------------------------------------
    Users:
      Count: 1
      # í‚¤ 1ê°œ ìƒì„±
  # ---------------------------------------------------------------------------
  # Org2: See "Org1" for full specification
  # ---------------------------------------------------------------------------
  - Name: Org2
    Domain: org2.example.com
    EnableNodeOUs: true
    Template:
      Count: 2
      # ì´ìª½ì´ í”¼ì–´ì˜ ìˆ«ì
    Users:
      Count: 1
      # í‚¤ 1ê°œ ìƒì„±
```





basic network ì˜ `crypto-config.yaml`(ì¸ì¦ì— ê´€í•œ ì •ë³´ê°€ ë“¤ì–´ìˆëŠ” íŒŒì¼)

```yaml
OrdererOrgs:
  - Name: Orderer
    Domain: example.com
    Specs:
      - Hostname: orderer # í˜¸ìŠ¤íŠ¸ê°€ 1ê°œì´ë¯€ë¡œ ì˜¤ë”ëŸ¬ê°€ 1ê°œì´ë‹¤.
PeerOrgs: # í”¼ì–´ ì¡°ì§
  - Name: Org1 # í”¼ì–´ ì¡°ì§ ì´ë¦„
    Domain: org1.example.com # í”¼ì–´ ì¡°ì§ì˜ ë„ë©”ì¸
    Template: # í”¼ì–´ì˜ ê°œìˆ˜
      Count: 1
    Users: # í”¼ì–´ ì¡°ì§ì˜ ì‚¬ìš©ì 1ëª…
      Count: 1
      
# 3ê°œ + 4ê°œ = 7ê°œì˜ mspê°€ ìƒì„±ë¨
ubuntu@ubuntu-jes:~/HLF/fabric-samples/basic-network$ tree | grep msp
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ msp
â”‚Â Â  â”‚Â Â      â”‚Â Â      â”œâ”€â”€ msp
â”‚Â Â  â”‚Â Â              â”œâ”€â”€ msp
â”‚Â Â          â”œâ”€â”€ msp
â”‚Â Â          â”‚Â Â      â”œâ”€â”€ msp
â”‚Â Â              â”‚Â Â  â”œâ”€â”€ msp
â”‚Â Â                  â”œâ”€â”€ msp

```

first network ì˜ `crypto-config.yaml`(ì¸ì¦ì— ê´€í•œ ì •ë³´ê°€ ë“¤ì–´ìˆëŠ” íŒŒì¼)

```yaml
OrdererOrgs: # ì˜¤ë”ëŸ¬ ì¡°ì§
  - Name: Orderer
    Domain: example.com
    EnableNodeOUs: true
    Specs: # ì˜¤ë”ëŸ¬ê°€ 5ê°œê°€ ìˆìŒ
      - Hostname: orderer
      - Hostname: orderer2
      - Hostname: orderer3
      - Hostname: orderer4
      - Hostname: orderer5
PeerOrgs:
  - Name: Org1 # í”¼ì–´ ì¡°ì§ 1
    Domain: org1.example.com
    EnableNodeOUs: true
    Template:
      Count: 2 # í”¼ì–´ ì¡°ì§ 1ì˜ í”¼ì–´ 2ê°œ
    Users:
      Count: 1 # í”¼ì–´ ì¡°ì§ 1ì˜ ìœ ì € 1ëª…
  - Name: Org2 # í”¼ì–´ ì¡°ì§ 2
    Domain: org2.example.com
    EnableNodeOUs: true
    Template:
      Count: 2 # í”¼ì–´ ì¡°ì§ 2ì˜ í”¼ì–´ 2ê°œ
    Users:
      Count: 1 # í”¼ì–´ ì¡°ì§ 2ì˜ ìœ ì € 1ëª…
      
# 7ê°œ + 5ê°œ + 5ê°œ = 17ê°œì˜ mspê°€ ìƒì„±ë¨
ubuntu@ubuntu-jes:~/HLF/fabric-samples/first-network$ tree | grep msp
â”‚Â Â  â”‚Â Â      â”œâ”€â”€ msp
â”‚Â Â  â”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ msp
â”‚Â Â  â”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ msp
â”‚Â Â  â”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ msp
â”‚Â Â  â”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ msp
â”‚Â Â  â”‚Â Â      â”‚Â Â      â”œâ”€â”€ msp
â”‚Â Â  â”‚Â Â              â”œâ”€â”€ msp
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ msp
â”‚Â Â      â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ msp
â”‚Â Â      â”‚Â Â  â”‚Â Â      â”œâ”€â”€ msp
â”‚Â Â      â”‚Â Â      â”‚Â Â  â”œâ”€â”€ msp
â”‚Â Â      â”‚Â Â          â”œâ”€â”€ msp
â”‚Â Â          â”œâ”€â”€ msp
â”‚Â Â          â”‚Â Â  â”‚Â Â  â”œâ”€â”€ msp
â”‚Â Â          â”‚Â Â      â”œâ”€â”€ msp
â”‚Â Â              â”‚Â Â  â”œâ”€â”€ msp
â”‚Â Â                  â”œâ”€â”€ msp
```



MSPì— ë“¤ì–´ê°€ëŠ” ì •ë³´ - P.63

```bash
CORE_PEER_LOCALMSPID=Org1MSP
CORE_PEER_ADDRESS=peer0.org1.example.com:7051
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt

CORE_PEER_LOCALMSPID=Org1MSP
CORE_PEER_ADDRESS=peer1.org1.example.com:8051
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/ca.crt

CORE_PEER_LOCALMSPID=Org2MSP
CORE_PEER_ADDRESS=peer0.org2.example.com:9051
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt

CORE_PEER_LOCALMSPID=Org2MSP
CORE_PEER_ADDRESS=peer1.org2.example.com:10051
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/ca.crt


peer chaincode install -n money -v 1.0 -p /opt/gopath/src/github.com/chaincode/fabcar/javascript/money.js -l node
peer chaincode instantiate -o orderer.example.com:7050 -C mychannel -n money -l node -v 1.0 -c '{"Args":[]}'
 -P "AND('Org1MSP.member','Org2MSP.member')" --tls
 --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
 --peerAddresses peer0.org1.example.com:7051
 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt

/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt


peer chaincode invoke \
    -o orderer.example.com:7050 \
    -C mychannel \
    -n fabcar2 \
    -c '{"function":"initToken","Args":["Hyechan","Dongwon","1000","200"]}' \
    --waitForEvent \
    --tls \
    --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem \
    --peerAddresses peer0.org1.example.com:7051 \
    --peerAddresses peer1.org1.example.com:8051 \
    --peerAddresses peer0.org2.example.com:9051 \
    --peerAddresses peer1.org2.example.com:10051 \
    --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \
    --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \
    --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt \
    --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
```

