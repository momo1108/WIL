rpcapi ‚Üí ÏÇ¨Ïö©Ìï† Î™ÖÎ†πÏñ¥ ÏÑ§Ï†ï



```cmd
C:\1blockchain\1etherium\3metacoin Œª truffle develop

truffle(develop)> compile
....
truffle(develop)> migrate
.....
truffle(develop)> var instance=await MetaCoin.deployed()
undefined
truffle(develop)> var accounts = await web3.eth.getAccounts() ‚Üê awaitÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ Î≥ÄÏàò Í∞í ÏßÄÏ†ïÏùÑ ÎπÑÎèôÍ∏∞Ìï®ÏàòÍ∞Ä ÏôÑÎ£åÎê† Îïå ÍπåÏßÄ Í∏∞Îã§Î†§Ï§ÄÎã§.
undefined
truffle(develop)> var balance1 = await instance.getBalance(accounts[0])
undefined
truffle(develop)> balance1
<BN: 2710>
truffle(develop)> accounts
[ '0x1E1284881e3C0698711d8A2c425796ebe8F51cec',
  '0xd4D4224467111d9FE3f51Fdd751B9054fC60541B',
  '0x9c473E1fA362c6A16442571d92f1a0bDeaEaB69a',
  '0xC4dfD7098447660a89371432EFf6287f81b2f6c3',
  '0x13f8D972EDd9fb6Ce3cbf40Ee2a546f621F34F46',
  '0xdfED916aD3f89842729d2753742483d631dBDD48',
  '0x0Bf6C84696Bec3B3999a039A88DE38E92545Bd9E',
  '0x70d00F6a33A449CB2159c2152d158a03a5F71674',
  '0x83D34Bc1EE875394bC4508f46DfE5975E2a4a442',
  '0xc3EA00758eC5e9498D155C75bC4333Abd938F087' ]
truffle(develop)> balance1.toNumber()
10000
truffle(develop)> var balance2 = await instance.getBalance(accounts[1])
undefined
truffle(develop)> balance2.toNumber()
0
truffle(develop)> instance.sendCoin(accounts[1], 1000)
.....
truffle(develop)> balance2.toNumber() ‚Üê Î≥ÄÏàòÎ°ú ÏÑ†Ïñ∏Ìï¥Ï§Ä balance2Í∞íÏù¥Í∏∞ ÎïåÎ¨∏Ïóê Í≥†Ï†ïÎêòÏñ¥ ÏûàÏñ¥ÏÑú Í∞±Ïã†(Îã§Ïãú ÏÑ†Ïñ∏)ÏùÑ Ìï¥Ï§òÏïº Ï†ÑÏÜ°ÏùÑ ÌôïÏù∏Ìï† Ïàò ÏûàÎã§.
0
truffle(develop)> var balance2 = await instance.getBalance(accounts[1])
undefined
truffle(develop)> balance2.toNumber()
1000
```

abi: application bytecode interface

```cmd
C:\1blockchain\1etherium\4vote
Œª truffle unbox react
truffle compile
...
truffle migrate --network develop
...
yarn install
...
yarn start
...

cd client/
```



smart contract(Ïù¥ÎçîÎ¶¨ÏõÄ, ÌïòÏù¥ÌçºÎ†àÏ†ÄÏóêÏÑúÎäî Ï≤¥Ïù∏ ÏΩîÎìú?)Î•º Îã§Î•∏Í≥≥ÏóêÏÑú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÍ≤å Ìï¥Ï£ºÎäî ÎèÑÏö∞ÎØ∏ Stub



truffle

compileÏùÑ ÌÜµÌï¥ Ïª®Ìä∏ÎûôÌä∏solidityÌååÏùºÏùÑ Î∞îÏù¥Ìä∏ÏΩîÎìúÌôî Ìï¥Ï£ºÍ≥† migrateÎ•º ÌÜµÌï¥ ganacheÎ°ú ÏÉùÏÑ±Ìïú Ïù¥ÎçîÎ¶¨ÏõÄ ÎÑ§Ìä∏ÏõåÌÅ¨Ïóê Î∞∞Ìè¨Î•º Ìï¥Ï§ÄÎã§. Ïù¥ÎçîÎ¶¨ÏõÄ ÎÑ§Ìä∏ÏõåÌÅ¨Ïóê Î∞∞Ìè¨Îêú Ïª®Ìä∏ÎûôÌä∏Î•º web3(stub)Î•º ÏÇ¨Ïö©Ìï¥ÏÑú Í∞ÄÏ†∏ÏôÄÏÑú ÏÇ¨Ïö©ÌïúÎã§(Ïù¥ ÌÜµÏã†Ïóê ÏÇ¨Ïö©ÌïòÎäîÍ≤å rpcÏù¥Í≥† Ïù¥Î•º ÎèÑÏôÄÏ£ºÎäî ÎèÑÏö∞ÎØ∏ Ïó≠Ìï†Î°ú skeletonÍ≥º stubÏù¥ ÏûàÎã§).



# ÌïòÏù¥ÌçºÎ†àÏ†∏

[https://developer.ibm.com/kr/cloud/blockchain/blockchain-special-series/2018/11/11/hyperledger-fabric-architecture-3-%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8%EA%B0%80-%EB%A7%8C%EB%93%9C%EB%8A%94-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC/](https://developer.ibm.com/kr/cloud/blockchain/blockchain-special-series/2018/11/11/hyperledger-fabric-architecture-3-Ïª¥Ìè¨ÎÑåÌä∏Í∞Ä-ÎßåÎìúÎäî-ÎÑ§Ìä∏ÏõåÌÅ¨/)

ÎÅäÏûÑÏóÜÏù¥ Ïã†ÏõêÌôïÏù∏ÏùÑ ÌïúÎã§.(Ï†ïÎßêÎ°ú Ïù¥ Î∏îÎ°ùÏ≤¥Ïù∏Ïùò Î©§Î≤ÑÍ∞Ä ÎßûÎäîÏßÄ) p.49

- Ïó¨Í∏∞Ïóê MSPÎ•º ÏÇ¨Ïö©

Î©§Î≤ÑÏâΩ - Íµ¨ÏÑ± Î∞©Î≤ï, Ï±ÑÎÑêÎ≥Ñ Íµ¨ÏÑ± Î∞©Î≤ï, Î©§Î≤ÑÏâΩ Î†àÎ≤® p.57

Peers - nodeÏó≠Ìï†(Í∞ÅÍ∞ÅÏùò Ïª¥Ìì®ÌÑ∞Îì§) p.66

Private data - Í∞ôÏùÄ Ï±ÑÎÑêÏóê ÏûàÎäî Ï°∞ÏßÅ ÌîºÏñ¥ÏóêÍ≤å Îç∞Ïù¥ÌÑ∞Î•º Í≥µÍ∞úÌïòÏßÄ ÏïäÎäî Î∞©Î≤ï p.81

- Privacy - Ï±ÑÎÑêÎì§ÎÅºÎ¶¨Îäî ÏÑúÎ°ú Ïïå Ïàò ÏóÜÎã§.

Ledger - ÏõêÏû• p.85

Í∞úÎ∞úÌôòÍ≤Ω Íµ¨Ï∂ï p.94

ÌäúÌÜ†Î¶¨Ïñº (First Network + FabCar) p.105

Marbles Demo - ÏûêÏÇ∞ Ïù¥ÎèôÏóê Í¥ÄÌïú Îç∞Î™®

CA

- hyperledgerÏóêÏÑúÏùò Ïù∏Ï¶ùÏùÄ ÎëêÍ∞ÄÏßÄ Î∞©ÏãùÏúºÎ°ú Í∞ÄÎä•
  1. caÎ°ú
  2. cryptogenÏúºÎ°ú
   - Ïù¥ Í≤ΩÏö∞ Ï±ÑÎÑêÏóê Ïù∏Ï¶ùÏ†ïÎ≥¥Í∞Ä ÏûàÍ∏∞ÎïåÎ¨∏Ïóê caÍ∞Ä ÏóÜÏñ¥ÎèÑ Í∞ÄÎä•
  
- Ïù¥ ÏÇ¨ÎûåÏù¥ OrdererÍ∞Ä ÎßûÎäîÏßÄ, PeerÍ∞Ä ÎßûÎäîÏßÄ ÌôïÏù∏Ìï¥Ï£ºÍ∏∞ ÏúÑÌïú Ïù∏Ï¶ùÍ∏∞Í¥Ä
- CAÍ∞Ä OrdererÏùò ÌôïÏù∏ÏùÑ ÎßàÏπòÎ©¥ OrdererÏóêÏÑúÎäî Ï±ÑÎÑêÏóê ÎåÄÌïú Genesis BlockÏù¥ ÏÉùÏÑ±ÎêòÍ≥† ÌîºÏñ¥Í∞Ä Ïó∞Í≤∞ÎêòÎ©¥ Í∑∏ ÌîºÏñ¥Ïóê Ï†ÑÎã¨ÎêúÎã§. Ìä∏ÎûúÏû≠ÏÖòÏóê ÎåÄÌïú BlockÏù¥ ÏÉùÏÑ±ÎêòÍ≥† Í∑∏ BlockÏù¥ ÏõêÏû•Ïóê ÌååÏùºÏãúÏä§ÌÖúÏúºÎ°ú Ï†ÄÏû•Ïù¥ÎêòÎäîÎç∞, Ïù¥Îü¨Ìïú ÌååÏùºÏùÄ ÏùΩÍ≥† Ïì∞ÎäîÎç∞ ÏãúÍ∞ÑÏù¥ Ïò§ÎûòÍ±∏Î¶¨Í∏∞ ÎïåÎ¨∏Ïóê B2BÏóêÏÑúÎäî Îπ†Î•∏ Îç∞Ïù¥ÌÑ∞ ÏùΩÍ∏∞Î•º ÏúÑÌïú ÏÉÅÌÉú Ï†ÄÏû• DB(Couch DB)=(World State?)Î•º ÏÇ¨Ïö©ÌïúÎã§. Ïù¥ DBÎ•º PeerÎßàÎã§ ÏÑ§ÏπòÌï¥Ïïº ÌïòÎäîÍ≤ÉÏùÄ ÎÑàÎ¨¥ Î≤àÍ±∞Î°≠Í∏∞ ÎïåÎ¨∏Ïóê IBMÏóêÏÑú DBÏ†ÑÏö© Ïª¥Ìì®ÌÑ∞Î•º ÎßåÎì§Ïñ¥ÏÑú ÏÇ¨Ïö©ÌïòÎèÑÎ°ù ÎßåÎì§ÏóàÎã§. Ïù¥Í≤ÉÏù¥ sample networkÎì§Ïùò CouchDB Ïª®ÌÖåÏù¥ÎÑàÏù¥Îã§.

Orderer

- Ìä∏ÎûúÏû≠ÏÖò ÌíÄÏóêÏÑú ÏàúÏÑúÎåÄÎ°ú Ïó¨Îü¨ Ìä∏ÎûúÏû≠ÏÖòÏùÑ Î∞õÏïÑÏÑú Î∏îÎü≠ÏùÑ ÏÉùÏÑ±Ìï¥ÏÑú ÎßûÎäî Ï±ÑÎÑêÏùò Î™®Îì† ÌîºÏñ¥Ïóê Ï†ÑÎã¨Ìï¥Ï§ÄÎã§ (Ï±ÑÎÑêÎßàÎã§Ïùò Ìä∏ÎûúÏû≠ÏÖò ÌíÄÏù¥ ÏûàÎäîÎç∞ Ïù¥Î•º ÌÜ†ÌîΩ(Queue ÌòïÏãù)Ïù¥ÎùºÌïúÎã§ - Ìïú Î∏îÎü≠Ïóê Î™áÍ∞úÏùò Ìä∏ÎûúÏû≠ÏÖòÏùÑ ÎÑ£ÏùÑÏßÄ Ï†ïÌï®(ÌïòÏù¥ÌçºÎ†àÏ†ÄÏóêÏÑúÏùò Ìï©ÏùòÏóêÏÑú)).

- Í∏∞Ï°¥Ïùò BlockchainÏùò Î™®Îì† ÎÖ∏ÎìúÍ∞Ä Î∏îÎ°ùÏùÑ ÏÉùÏÇ∞ÌïúÎã§Îäî ÎπÑÌö®Ïú®Ï†ÅÏù∏ Í≥ºÏ†ïÏùÑ ÏóÜÏï†Í∏∞ ÏúÑÌï¥ Î∏îÎ°ùÏùÑ ÏÉùÏÇ∞ÌïòÎäî ÌäπÏàò ÎÖ∏ÎìúÏù∏ OrdererÎ•º ÎßåÎì§ÏóàÎã§.

Ledger Íµ¨Ï°∞

- W(World State): ÏµúÏã† Ìä∏ÎûúÏû≠ÏÖòÎì§Ïùò ÏÉÅÌÉú Ï†ïÎ≥¥ - Îπ†Î•¥Í≤å ÏµúÏã† Ï†ïÎ≥¥Ïóê ÏóëÏÑ∏Ïä§ÌïòÎ†§Í≥† - ÏõêÏû•ÍπåÏßÄ Í∞ÄÏßÄÏïäÍ≥† Ï†ëÍ∑º Í∞ÄÎä•. ÏÇ¨Ïã§ Ïù¥ DBÎäî Í∞úÎÖêÏÉÅ LedgerÏïàÏóê Ìè¨Ìï®ÎêòÏñ¥ ÏûàÏßÄÎßå PeerÎßàÎã§ Î≥ÑÎèÑÎ°ú ÏÑ§ÏπòÎêòÏñ¥ÏûàÎäî DBÍ∞úÎÖêÏù¥Îã§.
- B: Î∏îÎ°ùÎì§Ïùò Ï≤¥Ïù∏

Peer

- Anchor Peer - Îã§Î•∏ Ï°∞ÏßÅ(Org)ÏôÄ ÌÜµÏã†ÌïòÎäî Peer(Î≥¥ÌÜµ Anchor PeerÍ∞Ä Leader PeerÏó≠Ìï†ÎèÑ Ìï®) Anchor PeerÎÅºÎ¶¨Îßå ÌÜµÏã†ÏùÑ ÌïòÎ©¥ ÎêòÍ∏∞ ÎïåÎ¨∏Ïóê Ï°∞ÏßÅÍ∞ÑÏùò ÌÜµÏã†ÏùÑ Í∞ÑÌé∏Ìôî Ìï¥Ï§å

- Ìä∏ÎûúÏû≠ÏÖòÏù¥ ÏÉùÏÑ±ÎêòÎ©¥ Î¨¥Ï°∞Í±¥ endorser node peerÍ∞Ä Ïã§ÌñâÌï¥Î≥¥Í≥† Í∑∏ Í≤ÄÏ¶ùÍ≤∞Í≥ºÎ•º cliÏóêÍ≤å Ï†ÑÎã¨Ìï¥Ï£ºÍ≥† Í≤ÄÏ¶ùÏù¥ Ï†úÎåÄÎ°ú ÎêòÏóàÏúºÎ©¥ cliÍ∞Ä OrdererÏóêÍ≤å Ï£ºÍ≥† OrdererÍ∞Ä Í∑∏Í≤ÉÏùÑ Îã§Ïãú Î™®Îì† Leader PeerÎì§ÏóêÍ≤å Ï§ÄÎã§. Leader PeerÎì§Ïù¥ Îã§Ïãú Ìä∏ÎûúÏû≠ÏÖòÏùÑ Í≤ÄÏ¶ùÌï¥Î≥¥Í≥† ÎßûÏúºÎ©¥ ÏõêÏû•Ïóê Ï†ÄÏû•ÌïòÍ≥† Îã§Î•∏ Ïù∏Ï†ë PeerÎì§(Ïù¥ PeerÎì§Ïóê ÎåÄÌïú Ï†ïÎ≥¥Í∞Ä ÌôïÏã§ÌïòÍ≤å Ï†ÄÏû•ÎêòÏñ¥ ÏûàÏñ¥Ïïº ÌïúÎã§)ÏóêÎèÑ Ï†ÑÎã¨, Í≤ÄÏ¶ù(Ïñ¥ÎäêÎÖ∏ÎìúÏù¥Îì†) ÌõÑ Î≥µÏÇ¨Í∞Ä ÎêúÍ≥† ÏµúÏã† ÏÉÅÌÉúÎäî CouchDBÏóê Ï†ÄÏû•ÎêúÎã§. Ïù¥Îü¨Ìïú Ï†ÑÎã¨ Ïó≠Ìï†ÏùÄ Leader PeerÎì§Îßå ÏàòÌñâÌï† Ïàò ÏûàÎã§.
- Í∞ôÏùÄ ChannelÏóê Î¨∂Ïù∏ PeerÎì§Ïù¥ÎùºÍ≥† Ìï†ÏßÄÎùºÎèÑ ÏõêÏû•Í≥º Îã¨Î¶¨ Chain CodeÎäî Î≥µÏÇ¨ÎêòÏñ¥ Í≥µÏú†ÎêòÏßÄ ÏïäÍ∏∞ ÎïåÎ¨∏Ïóê cliÎ°ú Ìïú PeerÏóê Chain CodeÎ•º installÌñàÎã§Í≥† ÌïòÎçîÎùºÎèÑ Îã§Î•∏ PeerÏóêÎèÑ ÏßÅÏ†ë installÏùÑ Ìï¥Ï£ºÏñ¥Ïïº Í∑∏ PeerÏóêÏÑú ÏÇ¨Ïö©Ïù¥ Í∞ÄÎä•ÌïòÎã§. ÌïòÏßÄÎßå Í∑∏ Chain CodeÎäî Ïù¥ÎØ∏ instantiate Í≥ºÏ†ïÏùÑ ÌÜµÌï¥ ChannelÏóê Îì±Î°ùÎêòÏóàÍ∏∞ ÎïåÎ¨∏Ïóê Ïù¥ Í≥ºÏ†ï(instantiate)ÏùÄ ÏÉùÎûµÌï¥ÎèÑ ÎêúÎã§.

- endorser
  - Ìä∏ÎûúÏû≠ÏÖòÏùÑ ÌôïÏù∏ = Í±∞Îûò Î≥¥Ï¶ùÏùÑ ÌôïÏù∏Ìï¥ÏÑú ÏùëÎãµÌï¥Ï§ÄÎã§.(ÏµúÏÜå 1Í∞ú ÎÖ∏Îìú Ïù¥ÏÉÅ. Îã§ÏàòÏùò(?) endorserÎì§Ïù¥ ÌãÄÎ¶¨Îã§Í≥† ÌåêÎã®ÌïòÎ©¥ ÏûòÎ™ªÎêú Í±∞ÎûòÎ°ú ÌåêÎã®)
  - Í±∞ÎûòÎ•º Ïã§ÌñâÌïòÎäî ÎÖ∏Îìú
- commiter
  - ÏõêÏû• Í∞±Ïã†ÏùÑ Ìï¥Ï§å(Î™®Îì† PeerÍ∞Ä commiterÍ∞Ä ÎêòÏñ¥Ïïº ÌïúÎã§).
  - Í±∞ÎûòÎ•º ÌôïÏ†ïÌï¥ÏÑú Î∏îÎ°ùÏ≤¥Ïù∏Ïóê Ï†ÄÏû•ÌïòÍ≤å ÌïòÎäî ÎÖ∏Îìú
- blockchain
- peer Î™ÖÎ†πÏñ¥ Ï§ë
  - queryÎäî world stateÏóê Ï†ëÍ∑ºÌïòÎäî Í≤ÉÏù¥Îùº Í∏∞Î°ùÏù¥ ÎÇ®ÏßÄ ÏïäÎäîÎã§
  - invokeÎäî Ï°∞ÌöåÏù¥Îì† ÏàòÏ†ïÏù¥Îì† ÏõêÏû•Ïóê Ï†ëÍ∑º(transactionÏúºÎ°ú ÎèôÏûë)ÌïòÎäî Í≤ÉÏù¥Îùº Í∏∞Î°ùÏù¥ ÎÇ®ÎäîÎã§.



cli> peer chaincode install -n jes -v 1.0 -p github.com/sacc (ü°∫jesÎùºÎäî Ïù¥Î¶ÑÏúºÎ°ú saccÎ•º ÏÑ§ÏπòÌïúÎã§)

Ïù¥ Î∂ÄÎ∂ÑÏóêÏÑú Ï≤¥Ïù∏ÏΩîÎìúÎ•º ÏÑ§ÏπòÌïú Í≤ÉÏù¥Îã§. Í≥µÏú†Î≥ºÎ•®Ïù∏ ~/HLF/fabric-samples/chaincodeÏóêÏÑú ÌôïÏù∏Ìï† Ïàò ÏûàÎã§.

Ï≤¥Ïù∏ÏΩîÎìú Í∞úÎ∞úÏûêÎäî SHIM API(nodeÏóêÏÑú 'fabric-shim')Î•º ÏïåÏïÑÏïºÌïúÎã§.

### ÌïòÏù¥ÌçºÎ†àÏ†∏ ÌùêÎ¶Ñ

1. cli(ClientÏó≠Ìï†)Í∞Ä peerÏóê tx ÏöîÏ≤≠
2. peerÍ∞Ä txÏùÑ Ïã§ÌñâÌï¥Î≥¥Í≥† 
3. Í∑∏ Í≤ÄÏ¶ù Í≤∞Í≥º(Endorsement)Î•º clientÏóêÍ≤å Îã§Ïãú Ï§å.
4. cli(ClientÏó≠Ìï†)Í∞Ä txÎ•º ordererÏóê boxing Ìï¥Îã¨Îùº ÏöîÏ≤≠
5. ordererÍ∞Ä Ìï©ÏùòÏïåÍ≥†Î¶¨Ï¶òÏóê ÏùòÌï¥ Î∞∞ÏπòÎ°ú tx ÏàúÏ∞® Ï†ïÎ¶¨
6. orderer Î∞ïÏã±ÌõÑ peerÏóê Ï†ÑÎã¨
7. peerÏóêÏÑú tx Í≤ÄÏ¶ù Î∞è ÏõêÏû• Ï†ÄÏû•(commit)
8. ÏõêÏû• ÏóÖÎç∞Ïù¥Ìä∏ ÌõÑ world stateÏóê Ï†ÄÏû•(CouchDB)

**(Î™®Îì† Í≥ºÏ†ïÏóêÏÑú Ïã†ÏõêÌôïÏù∏ CA)**

install ÏùÄ peerÏóê chaincodeÎ•º ÏÑ§ÏπòÌï† Îøê ordererÍ∞Ä Ïù∏ÏãùÌïòÏßÄ Î™ªÌïúÎã§. instantiateÎ•º Ìï¥Ïïº Ï±ÑÎÑêÏóê Ïó∞Í≤∞ÎêòÍ≥† ordererÍ∞Ä Ïïå Ïàò ÏûàÎã§.

ÏõêÏû• fileÏù∏ blockfileÏùÄ Ï±ÑÎÑê Îãπ ÌïòÎÇòÎßå ÏÉùÏÑ±ÎêúÎã§. Í∑∏Î¶ºÏÉÅ C1Ïùò L1. Í∞ôÏùÄ Ï±ÑÎÑêÏóê ÏÉàÎ°úÏö¥ chaincodeÍ∞Ä ÏÑ§ÏπòÎêòÏñ¥ÎèÑ ÏõêÏû•ÏùÄ ÌïòÎÇòÎßå ÏÉùÏÑ±ÎêúÎã§.

Ïã§ÏäµÍ≥ºÏ†ïÏóêÏÑú ÏõîÎ†õÏùÑ ÏÉùÏÑ±ÌïòÏó¨ Í∑∏Í≥≥Ïóê ÏûàÎäî Private KeyÎ•º Ïù¥Ïö©Ìï¥ Ïã†ÏõêÌôïÏù∏ÏùÑ ÌïúÎã§.



### Ïã§Ï†ÑÏïïÏ∂ï Î™ÖÎ†πÏñ¥

```bash
ubuntu@ubuntu-jes:~/HLF/fabric-samples/basic-network$ ./start.sh
ubuntu@ubuntu-jes:~/HLF/fabric-samples/basic-network$ sudo docker ps -a
ubuntu@ubuntu-jes:~/HLF/fabric-samples/basic-network$ docker exec -it cli bash
cli>peer chaincode install -n jes -v 1.0 -p github.com/sacc
cli>peer chaincode instantiate -n jes -v 1.0 -c ‚Äò{‚ÄúArgs‚Äù:[‚Äúa‚Äù,‚Äù10‚Äù]}‚Äô -C mychannel
cli>peer chaincode query -n jes -c ‚Äò{‚ÄúArgs‚Äù:[‚Äúget‚Äù,‚Äùa‚Äù]}‚Äô -C mychannel
cli>peer chaincode invoke -n jes -c ‚Äò{‚ÄúArgs‚Äù:[‚Äúset‚Äù,‚Äùa‚Äù,‚Äù200‚Äù]}‚Äô -C mychannel
cli>peer chaincode query -n jes -c ‚Äò{‚ÄúArgs‚Äù:[‚Äúget‚Äù,‚Äùa‚Äù]}‚Äô -C mychannel
```

### Í¥ÄÎ†® ÌååÏùº

`start.sh`, `docker-compose.yml`, `configtx.yaml(&Îäî Ï†ïÏùò, *Îäî Ï∞∏Ï°∞)`, `crypto-config.yaml`



### First Network script

`eyfn.sh`Ïùò ÏùºÎ∂Ä

```sh
if [ "${MODE}" == "up" ]; then
  networkUp
elif [ "${MODE}" == "down" ]; then ## Clear the network
  networkDown
elif [ "${MODE}" == "generate" ]; then ## Generate Artifacts
  generateCerts
  replacePrivateKey
  generateChannelArtifacts
elif [ "${MODE}" == "restart" ]; then ## Restart the network
  networkDown
  networkUp
elif [ "${MODE}" == "upgrade" ]; then ## Upgrade the network from version 1.2.x to 1.3.x
  upgradeNetwork
else
  printHelp
  exit 1
fi

# Generates Org certs using cryptogen tool
function generateCerts() {
  which cryptogen
  if [ "$?" -ne 0 ]; then
    echo "cryptogen tool not found. exiting"
    exit 1
  fi
  echo
  echo "##########################################################"
  echo "##### Generate certificates using cryptogen tool #########"
  echo "##########################################################"

  if [ -d "crypto-config" ]; then
    rm -Rf crypto-config
  fi
  set -x
  cryptogen generate --config=./crypto-config.yaml
  res=$?
  set +x
  if [ $res -ne 0 ]; then
    echo "Failed to generate certificates..."
    exit 1
  fi
  echo
  echo "Generate CCP files for Org1 and Org2"
  ./ccp-generate.sh
}

# Using docker-compose-e2e-template.yaml, replace constants with private key file names
# generated by the cryptogen tool and output a docker-compose.yaml specific to this
# configuration
function replacePrivateKey() {
  # sed on MacOSX does not support -i flag with a null extension. We will use
  # 't' for our back-up's extension and delete it at the end of the function
  ARCH=$(uname -s | grep Darwin)
  if [ "$ARCH" == "Darwin" ]; then
    OPTS="-it"
  else
    OPTS="-i"
  fi

  # Copy the template to the file that will be modified to add the private key
  cp docker-compose-e2e-template.yaml docker-compose-e2e.yaml

  # The next steps will replace the template's contents with the
  # actual values of the private key file names for the two CAs.
  CURRENT_DIR=$PWD
  cd crypto-config/peerOrganizations/org1.example.com/ca/
  PRIV_KEY=$(ls *_sk)
  cd "$CURRENT_DIR"
  sed $OPTS "s/CA1_PRIVATE_KEY/${PRIV_KEY}/g" docker-compose-e2e.yaml
  cd crypto-config/peerOrganizations/org2.example.com/ca/
  PRIV_KEY=$(ls *_sk)
  cd "$CURRENT_DIR"
  sed $OPTS "s/CA2_PRIVATE_KEY/${PRIV_KEY}/g" docker-compose-e2e.yaml
  # If MacOSX, remove the temporary backup of the docker-compose file
  if [ "$ARCH" == "Darwin" ]; then
    rm docker-compose-e2e.yamlt
  fi
}

# Generate orderer genesis block, channel configuration transaction and
# anchor peer update transactions
function generateChannelArtifacts() {
  which configtxgen
  if [ "$?" -ne 0 ]; then
    echo "configtxgen tool not found. exiting"
    exit 1
  fi

  echo "##########################################################"
  echo "#########  Generating Orderer Genesis block ##############"
  echo "##########################################################"
  # Note: For some unknown reason (at least for now) the block file can't be
  # named orderer.genesis.block or the orderer will fail to launch!
  echo "CONSENSUS_TYPE="$CONSENSUS_TYPE
  set -x
  if [ "$CONSENSUS_TYPE" == "solo" ]; then
    configtxgen -profile TwoOrgsOrdererGenesis -channelID $SYS_CHANNEL -outputBlock ./channel-artifacts/genesis.block
  elif [ "$CONSENSUS_TYPE" == "kafka" ]; then
    configtxgen -profile SampleDevModeKafka -channelID $SYS_CHANNEL -outputBlock ./channel-artifacts/genesis.block
  elif [ "$CONSENSUS_TYPE" == "etcdraft" ]; then
    configtxgen -profile SampleMultiNodeEtcdRaft -channelID $SYS_CHANNEL -outputBlock ./channel-artifacts/genesis.block
  else
    set +x
    echo "unrecognized CONSESUS_TYPE='$CONSENSUS_TYPE'. exiting"
    exit 1
  fi
  res=$?
  set +x
  if [ $res -ne 0 ]; then
    echo "Failed to generate orderer genesis block..."
    exit 1
  fi
  echo
  echo "#################################################################"
  echo "### Generating channel configuration transaction 'channel.tx' ###"
  echo "#################################################################"
  set -x
  configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID $CHANNEL_NAME
  res=$?
  set +x
  if [ $res -ne 0 ]; then
    echo "Failed to generate channel configuration transaction..."
    exit 1
  fi

  echo
  echo "#################################################################"
  echo "#######    Generating anchor peer update for Org1MSP   ##########"
  echo "#################################################################"
  set -x
  configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org1MSP
  res=$?
  set +x
  if [ $res -ne 0 ]; then
    echo "Failed to generate anchor peer update for Org1MSP..."
    exit 1
  fi

  echo
  echo "#################################################################"
  echo "#######    Generating anchor peer update for Org2MSP   ##########"
  echo "#################################################################"
  set -x
  configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate \
    ./channel-artifacts/Org2MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org2MSP
  res=$?
  set +x
  if [ $res -ne 0 ]; then
    echo "Failed to generate anchor peer update for Org2MSP..."
    exit 1
  fi
  echo
}

# Generate the needed certificates, the genesis block and start the network.
function networkUp() {
  checkPrereqs
  # generate artifacts if they don't exist
  if [ ! -d "crypto-config" ]; then
    generateCerts
    replacePrivateKey
    generateChannelArtifacts
  fi
  COMPOSE_FILES="-f ${COMPOSE_FILE}"
  if [ "${CERTIFICATE_AUTHORITIES}" == "true" ]; then
    COMPOSE_FILES="${COMPOSE_FILES} -f ${COMPOSE_FILE_CA}"
    export BYFN_CA1_PRIVATE_KEY=$(cd crypto-config/peerOrganizations/org1.example.com/ca && ls *_sk)
    export BYFN_CA2_PRIVATE_KEY=$(cd crypto-config/peerOrganizations/org2.example.com/ca && ls *_sk)
  fi
  if [ "${CONSENSUS_TYPE}" == "kafka" ]; then
    COMPOSE_FILES="${COMPOSE_FILES} -f ${COMPOSE_FILE_KAFKA}"
  elif [ "${CONSENSUS_TYPE}" == "etcdraft" ]; then
    COMPOSE_FILES="${COMPOSE_FILES} -f ${COMPOSE_FILE_RAFT2}"
  fi
  if [ "${IF_COUCHDB}" == "couchdb" ]; then
    COMPOSE_FILES="${COMPOSE_FILES} -f ${COMPOSE_FILE_COUCH}"
  fi
  IMAGE_TAG=$IMAGETAG docker-compose ${COMPOSE_FILES} up -d 2>&1
  docker ps -a
  if [ $? -ne 0 ]; then
    echo "ERROR !!!! Unable to start network"
    exit 1
  fi

  if [ "$CONSENSUS_TYPE" == "kafka" ]; then
    sleep 1
    echo "Sleeping 10s to allow $CONSENSUS_TYPE cluster to complete booting"
    sleep 9
  fi

  if [ "$CONSENSUS_TYPE" == "etcdraft" ]; then
    sleep 1
    echo "Sleeping 15s to allow $CONSENSUS_TYPE cluster to complete booting"
    sleep 14
  fi

  # now run the end to end script
  docker exec cli scripts/script.sh $CHANNEL_NAME $CLI_DELAY $LANGUAGE $CLI_TIMEOUT $VERBOSE $NO_CHAINCODE
  if [ $? -ne 0 ]; then
    echo "ERROR !!!! Test failed"
    exit 1
  fi
}
```

networkUp funtionÏùò ÎßàÏßÄÎßâÏóê cli Ïóê Í≥µÏú†Î≥ºÎ•®ÏùÑ ÏÇ¨Ïö©Ìï¥ Ï†úÍ≥µÌïú script.sh ÌååÏùºÏùÑ Ïã§ÌñâÌïòÎùº ÌïúÎã§.

`script.sh`

```sh
#!/bin/bash

echo
echo " ____    _____      _      ____    _____ "
echo "/ ___|  |_   _|    / \    |  _ \  |_   _|"
echo "\___ \    | |     / _ \   | |_) |   | |  "
echo " ___) |   | |    / ___ \  |  _ <    | |  "
echo "|____/    |_|   /_/   \_\ |_| \_\   |_|  "
echo
echo "Build your first network (BYFN) end-to-end test"
echo
CHANNEL_NAME="$1"
DELAY="$2"
LANGUAGE="$3"
TIMEOUT="$4"
VERBOSE="$5"
NO_CHAINCODE="$6"
: ${CHANNEL_NAME:="mychannel"}
: ${DELAY:="3"}
: ${LANGUAGE:="golang"}
: ${TIMEOUT:="10"}
: ${VERBOSE:="false"}
: ${NO_CHAINCODE:="false"}
LANGUAGE=`echo "$LANGUAGE" | tr [:upper:] [:lower:]`
COUNTER=1
MAX_RETRY=10

CC_SRC_PATH="github.com/chaincode/chaincode_example02/go/"
if [ "$LANGUAGE" = "node" ]; then
	CC_SRC_PATH="/opt/gopath/src/github.com/chaincode/chaincode_example02/node/"
fi

if [ "$LANGUAGE" = "java" ]; then
	CC_SRC_PATH="/opt/gopath/src/github.com/chaincode/chaincode_example02/java/"
fi

echo "Channel name : "$CHANNEL_NAME

# import utils
. scripts/utils.sh

createChannel() {
	setGlobals 0 1

	if [ -z "$CORE_PEER_TLS_ENABLED" -o "$CORE_PEER_TLS_ENABLED" = "false" ]; then
                set -x
		peer channel create -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/channel.tx >&log.txt
		res=$?
                set +x
	else
				set -x
		peer channel create -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/channel.tx --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA >&log.txt
		res=$?
				set +x
	fi
	cat log.txt
	verifyResult $res "Channel creation failed"
	echo "===================== Channel '$CHANNEL_NAME' created ===================== "
	echo
}

joinChannel () {
	for org in 1 2; do
	    for peer in 0 1; do
		joinChannelWithRetry $peer $org
		echo "===================== peer${peer}.org${org} joined channel '$CHANNEL_NAME' ===================== "
		sleep $DELAY
		echo
	    done
	done
}

## Create channel
echo "Creating channel..."
createChannel

## Join all the peers to the channel
echo "Having all peers join the channel..."
joinChannel

## Set the anchor peers for each org in the channel
echo "Updating anchor peers for org1..."
updateAnchorPeers 0 1
echo "Updating anchor peers for org2..."
updateAnchorPeers 0 2

if [ "${NO_CHAINCODE}" != "true" ]; then

	## Install chaincode on peer0.org1 and peer0.org2
	echo "Installing chaincode on peer0.org1..."
	installChaincode 0 1
	echo "Install chaincode on peer0.org2..."
	installChaincode 0 2

	# Instantiate chaincode on peer0.org2
	echo "Instantiating chaincode on peer0.org2..."
	instantiateChaincode 0 2

	# Query chaincode on peer0.org1
	echo "Querying chaincode on peer0.org1..."
	chaincodeQuery 0 1 100

	# Invoke chaincode on peer0.org1 and peer0.org2
	echo "Sending invoke transaction on peer0.org1 peer0.org2..."
	chaincodeInvoke 0 1 0 2
	
	## Install chaincode on peer1.org2
	echo "Installing chaincode on peer1.org2..."
	installChaincode 1 2

	# Query on chaincode on peer1.org2, check if the result is 90
	echo "Querying chaincode on peer1.org2..."
	chaincodeQuery 1 2 90
	
fi

echo
echo "========= All GOOD, BYFN execution completed =========== "
echo

echo
echo " _____   _   _   ____   "
echo "| ____| | \ | | |  _ \  "
echo "|  _|   |  \| | | | | | "
echo "| |___  | |\  | | |_| | "
echo "|_____| |_| \_| |____/  "
echo

exit 0
```

`script.sh`ÏóêÏÑú Î∂àÎü¨Ïò® `utils.sh`

```sh
#
# Copyright IBM Corp All Rights Reserved
#
# SPDX-License-Identifier: Apache-2.0
#

# This is a collection of bash functions used by different scripts

ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
PEER0_ORG1_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
PEER0_ORG2_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
PEER0_ORG3_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/peers/peer0.org3.example.com/tls/ca.crt

# verify the result of the end-to-end test
verifyResult() {
  if [ $1 -ne 0 ]; then
    echo "!!!!!!!!!!!!!!! "$2" !!!!!!!!!!!!!!!!"
    echo "========= ERROR !!! FAILED to execute End-2-End Scenario ==========="
    echo
    exit 1
  fi
}

# Set OrdererOrg.Admin globals
setOrdererGlobals() {
  CORE_PEER_LOCALMSPID="OrdererMSP"
  CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
  CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/users/Admin@example.com/msp
}

setGlobals() {
  PEER=$1
  ORG=$2
  if [ $ORG -eq 1 ]; then
    CORE_PEER_LOCALMSPID="Org1MSP"
    CORE_PEER_TLS_ROOTCERT_FILE=$PEER0_ORG1_CA
    CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
    if [ $PEER -eq 0 ]; then
      CORE_PEER_ADDRESS=peer0.org1.example.com:7051
    else
      CORE_PEER_ADDRESS=peer1.org1.example.com:8051
    fi
  elif [ $ORG -eq 2 ]; then
    CORE_PEER_LOCALMSPID="Org2MSP"
    CORE_PEER_TLS_ROOTCERT_FILE=$PEER0_ORG2_CA
    CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
    if [ $PEER -eq 0 ]; then
      CORE_PEER_ADDRESS=peer0.org2.example.com:9051
    else
      CORE_PEER_ADDRESS=peer1.org2.example.com:10051
    fi

  elif [ $ORG -eq 3 ]; then
    CORE_PEER_LOCALMSPID="Org3MSP"
    CORE_PEER_TLS_ROOTCERT_FILE=$PEER0_ORG3_CA
    CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org3.example.com/users/Admin@org3.example.com/msp
    if [ $PEER -eq 0 ]; then
      CORE_PEER_ADDRESS=peer0.org3.example.com:11051
    else
      CORE_PEER_ADDRESS=peer1.org3.example.com:12051
    fi
  else
    echo "================== ERROR !!! ORG Unknown =================="
  fi

  if [ "$VERBOSE" == "true" ]; then
    env | grep CORE
  fi
}

updateAnchorPeers() {
  PEER=$1
  ORG=$2
  setGlobals $PEER $ORG

  if [ -z "$CORE_PEER_TLS_ENABLED" -o "$CORE_PEER_TLS_ENABLED" = "false" ]; then
    set -x
    peer channel update -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/${CORE_PEER_LOCALMSPID}anchors.tx >&log.txt
    res=$?
    set +x
  else
    set -x
    peer channel update -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/${CORE_PEER_LOCALMSPID}anchors.tx --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA >&log.txt
    res=$?
    set +x
  fi
  cat log.txt
  verifyResult $res "Anchor peer update failed"
  echo "===================== Anchor peers updated for org '$CORE_PEER_LOCALMSPID' on channel '$CHANNEL_NAME' ===================== "
  sleep $DELAY
  echo
}

## Sometimes Join takes time hence RETRY at least 5 times
joinChannelWithRetry() {
  PEER=$1
  ORG=$2
  setGlobals $PEER $ORG

  set -x
  peer channel join -b $CHANNEL_NAME.block >&log.txt
  res=$?
  set +x
  cat log.txt
  if [ $res -ne 0 -a $COUNTER -lt $MAX_RETRY ]; then
    COUNTER=$(expr $COUNTER + 1)
    echo "peer${PEER}.org${ORG} failed to join the channel, Retry after $DELAY seconds"
    sleep $DELAY
    joinChannelWithRetry $PEER $ORG
  else
    COUNTER=1
  fi
  verifyResult $res "After $MAX_RETRY attempts, peer${PEER}.org${ORG} has failed to join channel '$CHANNEL_NAME' "
}

installChaincode() {
  PEER=$1
  ORG=$2
  setGlobals $PEER $ORG
  VERSION=${3:-1.0}
  set -x
  peer chaincode install -n mycc -v ${VERSION} -l ${LANGUAGE} -p ${CC_SRC_PATH} >&log.txt
  res=$?
  set +x
  cat log.txt
  verifyResult $res "Chaincode installation on peer${PEER}.org${ORG} has failed"
  echo "===================== Chaincode is installed on peer${PEER}.org${ORG} ===================== "
  echo
}

instantiateChaincode() {
  PEER=$1
  ORG=$2
  setGlobals $PEER $ORG
  VERSION=${3:-1.0}

  # while 'peer chaincode' command can get the orderer endpoint from the peer
  # (if join was successful), let's supply it directly as we know it using
  # the "-o" option
  if [ -z "$CORE_PEER_TLS_ENABLED" -o "$CORE_PEER_TLS_ENABLED" = "false" ]; then
    set -x
    peer chaincode instantiate -o orderer.example.com:7050 -C $CHANNEL_NAME -n mycc -l ${LANGUAGE} -v ${VERSION} -c '{"Args":["init","a","100","b","200"]}' -P "AND ('Org1MSP.peer','Org2MSP.peer')" >&log.txt
    res=$?
    set +x
  else
    set -x
    peer chaincode instantiate -o orderer.example.com:7050 --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA -C $CHANNEL_NAME -n mycc -l ${LANGUAGE} -v 1.0 -c '{"Args":["init","a","100","b","200"]}' -P "AND ('Org1MSP.peer','Org2MSP.peer')" >&log.txt
    res=$?
    set +x
  fi
  cat log.txt
  verifyResult $res "Chaincode instantiation on peer${PEER}.org${ORG} on channel '$CHANNEL_NAME' failed"
  echo "===================== Chaincode is instantiated on peer${PEER}.org${ORG} on channel '$CHANNEL_NAME' ===================== "
  echo
}

upgradeChaincode() {
  PEER=$1
  ORG=$2
  setGlobals $PEER $ORG

  set -x
  peer chaincode upgrade -o orderer.example.com:7050 --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA -C $CHANNEL_NAME -n mycc -v 2.0 -c '{"Args":["init","a","90","b","210"]}' -P "AND ('Org1MSP.peer','Org2MSP.peer','Org3MSP.peer')"
  res=$?
  set +x
  cat log.txt
  verifyResult $res "Chaincode upgrade on peer${PEER}.org${ORG} has failed"
  echo "===================== Chaincode is upgraded on peer${PEER}.org${ORG} on channel '$CHANNEL_NAME' ===================== "
  echo
}

chaincodeQuery() {
  PEER=$1
  ORG=$2
  setGlobals $PEER $ORG
  EXPECTED_RESULT=$3
  echo "===================== Querying on peer${PEER}.org${ORG} on channel '$CHANNEL_NAME'... ===================== "
  local rc=1
  local starttime=$(date +%s)

  # continue to poll
  # we either get a successful response, or reach TIMEOUT
  while
    test "$(($(date +%s) - starttime))" -lt "$TIMEOUT" -a $rc -ne 0
  do
    sleep $DELAY
    echo "Attempting to Query peer${PEER}.org${ORG} ...$(($(date +%s) - starttime)) secs"
    set -x
    peer chaincode query -C $CHANNEL_NAME -n mycc -c '{"Args":["query","a"]}' >&log.txt
    res=$?
    set +x
    test $res -eq 0 && VALUE=$(cat log.txt | awk '/Query Result/ {print $NF}')
    test "$VALUE" = "$EXPECTED_RESULT" && let rc=0
    # removed the string "Query Result" from peer chaincode query command
    # result. as a result, have to support both options until the change
    # is merged.
    test $rc -ne 0 && VALUE=$(cat log.txt | egrep '^[0-9]+$')
    test "$VALUE" = "$EXPECTED_RESULT" && let rc=0
  done
  echo
  cat log.txt
  if test $rc -eq 0; then
    echo "===================== Query successful on peer${PEER}.org${ORG} on channel '$CHANNEL_NAME' ===================== "
  else
    echo "!!!!!!!!!!!!!!! Query result on peer${PEER}.org${ORG} is INVALID !!!!!!!!!!!!!!!!"
    echo "================== ERROR !!! FAILED to execute End-2-End Scenario =================="
    echo
    exit 1
  fi
}

# fetchChannelConfig <channel_id> <output_json>
# Writes the current channel config for a given channel to a JSON file
fetchChannelConfig() {
  CHANNEL=$1
  OUTPUT=$2

  setOrdererGlobals

  echo "Fetching the most recent configuration block for the channel"
  if [ -z "$CORE_PEER_TLS_ENABLED" -o "$CORE_PEER_TLS_ENABLED" = "false" ]; then
    set -x
    peer channel fetch config config_block.pb -o orderer.example.com:7050 -c $CHANNEL --cafile $ORDERER_CA
    set +x
  else
    set -x
    peer channel fetch config config_block.pb -o orderer.example.com:7050 -c $CHANNEL --tls --cafile $ORDERER_CA
    set +x
  fi

  echo "Decoding config block to JSON and isolating config to ${OUTPUT}"
  set -x
  configtxlator proto_decode --input config_block.pb --type common.Block | jq .data.data[0].payload.data.config >"${OUTPUT}"
  set +x
}

# signConfigtxAsPeerOrg <org> <configtx.pb>
# Set the peerOrg admin of an org and signing the config update
signConfigtxAsPeerOrg() {
  PEERORG=$1
  TX=$2
  setGlobals 0 $PEERORG
  set -x
  peer channel signconfigtx -f "${TX}"
  set +x
}

# createConfigUpdate <channel_id> <original_config.json> <modified_config.json> <output.pb>
# Takes an original and modified config, and produces the config update tx
# which transitions between the two
createConfigUpdate() {
  CHANNEL=$1
  ORIGINAL=$2
  MODIFIED=$3
  OUTPUT=$4

  set -x
  configtxlator proto_encode --input "${ORIGINAL}" --type common.Config >original_config.pb
  configtxlator proto_encode --input "${MODIFIED}" --type common.Config >modified_config.pb
  configtxlator compute_update --channel_id "${CHANNEL}" --original original_config.pb --updated modified_config.pb >config_update.pb
  configtxlator proto_decode --input config_update.pb --type common.ConfigUpdate >config_update.json
  echo '{"payload":{"header":{"channel_header":{"channel_id":"'$CHANNEL'", "type":2}},"data":{"config_update":'$(cat config_update.json)'}}}' | jq . >config_update_in_envelope.json
  configtxlator proto_encode --input config_update_in_envelope.json --type common.Envelope >"${OUTPUT}"
  set +x
}

# parsePeerConnectionParameters $@
# Helper function that takes the parameters from a chaincode operation
# (e.g. invoke, query, instantiate) and checks for an even number of
# peers and associated org, then sets $PEER_CONN_PARMS and $PEERS
parsePeerConnectionParameters() {
  # check for uneven number of peer and org parameters
  if [ $(($# % 2)) -ne 0 ]; then
    exit 1
  fi

  PEER_CONN_PARMS=""
  PEERS=""
  while [ "$#" -gt 0 ]; do
    setGlobals $1 $2
    PEER="peer$1.org$2"
    PEERS="$PEERS $PEER"
    PEER_CONN_PARMS="$PEER_CONN_PARMS --peerAddresses $CORE_PEER_ADDRESS"
    if [ -z "$CORE_PEER_TLS_ENABLED" -o "$CORE_PEER_TLS_ENABLED" = "true" ]; then
      TLSINFO=$(eval echo "--tlsRootCertFiles \$PEER$1_ORG$2_CA")
      PEER_CONN_PARMS="$PEER_CONN_PARMS $TLSINFO"
    fi
    # shift by two to get the next pair of peer/org parameters
    shift
    shift
  done
  # remove leading space for output
  PEERS="$(echo -e "$PEERS" | sed -e 's/^[[:space:]]*//')"
}

# chaincodeInvoke <peer> <org> ...
# Accepts as many peer/org pairs as desired and requests endorsement from each
chaincodeInvoke() {
  parsePeerConnectionParameters $@
  res=$?
  verifyResult $res "Invoke transaction failed on channel '$CHANNEL_NAME' due to uneven number of peer and org parameters "

  # while 'peer chaincode' command can get the orderer endpoint from the
  # peer (if join was successful), let's supply it directly as we know
  # it using the "-o" option
  if [ -z "$CORE_PEER_TLS_ENABLED" -o "$CORE_PEER_TLS_ENABLED" = "false" ]; then
    set -x
    peer chaincode invoke -o orderer.example.com:7050 -C $CHANNEL_NAME -n mycc $PEER_CONN_PARMS -c '{"Args":["invoke","a","b","10"]}' >&log.txt
    res=$?
    set +x
  else
    set -x
    peer chaincode invoke -o orderer.example.com:7050 --tls $CORE_PEER_TLS_ENABLED --cafile $ORDERER_CA -C $CHANNEL_NAME -n mycc $PEER_CONN_PARMS -c '{"Args":["invoke","a","b","10"]}' >&log.txt
    res=$?
    set +x
  fi
  cat log.txt
  verifyResult $res "Invoke execution on $PEERS failed "
  echo "===================== Invoke transaction successful on $PEERS on channel '$CHANNEL_NAME' ===================== "
  echo
}
```









`crypto-config.yaml`

```yaml
# Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

# ---------------------------------------------------------------------------
# "OrdererOrgs" - Definition of organizations managing orderer nodes
# ---------------------------------------------------------------------------
OrdererOrgs:
  # ---------------------------------------------------------------------------
  # Orderer
  # ---------------------------------------------------------------------------
  - Name: Orderer
    Domain: example.com
    EnableNodeOUs: true
    # ---------------------------------------------------------------------------
    # "Specs" - See PeerOrgs below for complete description
    # ---------------------------------------------------------------------------
    Specs:
      - Hostname: orderer
      - Hostname: orderer2
      - Hostname: orderer3
      - Hostname: orderer4
      - Hostname: orderer5
	# Ïù¥Ï™Ω key 5Í∞ú ÏÉùÏÑ±
# ---------------------------------------------------------------------------
# "PeerOrgs" - Definition of organizations managing peer nodes
# ---------------------------------------------------------------------------
PeerOrgs:
  # ---------------------------------------------------------------------------
  # Org1
  # ---------------------------------------------------------------------------
  - Name: Org1
    Domain: org1.example.com
    EnableNodeOUs: true
    # ---------------------------------------------------------------------------
    # "Specs"
    # ---------------------------------------------------------------------------
    # Uncomment this section to enable the explicit definition of hosts in your
    # configuration.  Most users will want to use Template, below
    #
    # Specs is an array of Spec entries.  Each Spec entry consists of two fields:
    #   - Hostname:   (Required) The desired hostname, sans the domain.
    #   - CommonName: (Optional) Specifies the template or explicit override for
    #                 the CN.  By default, this is the template:
    #
    #                              "{{.Hostname}}.{{.Domain}}"
    #
    #                 which obtains its values from the Spec.Hostname and
    #                 Org.Domain, respectively.
    # ---------------------------------------------------------------------------
    # Specs:
    #   - Hostname: foo # implicitly "foo.org1.example.com"
    #     CommonName: foo27.org5.example.com # overrides Hostname-based FQDN set above
    #   - Hostname: bar
    #   - Hostname: baz
    # ---------------------------------------------------------------------------
    # "Template"
    # ---------------------------------------------------------------------------
    # Allows for the definition of 1 or more hosts that are created sequentially
    # from a template. By default, this looks like "peer%d" from 0 to Count-1.
    # You may override the number of nodes (Count), the starting index (Start)
    # or the template used to construct the name (Hostname).
    #
    # Note: Template and Specs are not mutually exclusive.  You may define both
    # sections and the aggregate nodes will be created for you.  Take care with
    # name collisions
    # ---------------------------------------------------------------------------
    Template:
      Count: 2
      # Ïù¥Ï™ΩÏù¥ ÌîºÏñ¥Ïùò Ïà´Ïûê
      # Start: 5
      # Hostname: {{.Prefix}}{{.Index}} # default
    # ---------------------------------------------------------------------------
    # "Users"
    # ---------------------------------------------------------------------------
    # Count: The number of user accounts _in addition_ to Admin
    # ---------------------------------------------------------------------------
    Users:
      Count: 1
      # ÌÇ§ 1Í∞ú ÏÉùÏÑ±
  # ---------------------------------------------------------------------------
  # Org2: See "Org1" for full specification
  # ---------------------------------------------------------------------------
  - Name: Org2
    Domain: org2.example.com
    EnableNodeOUs: true
    Template:
      Count: 2
      # Ïù¥Ï™ΩÏù¥ ÌîºÏñ¥Ïùò Ïà´Ïûê
    Users:
      Count: 1
      # ÌÇ§ 1Í∞ú ÏÉùÏÑ±
```





basic network Ïùò `crypto-config.yaml`(Ïù∏Ï¶ùÏóê Í¥ÄÌïú Ï†ïÎ≥¥Í∞Ä Îì§Ïñ¥ÏûàÎäî ÌååÏùº)

```yaml
OrdererOrgs:
  - Name: Orderer
    Domain: example.com
    Specs:
      - Hostname: orderer # Ìò∏Ïä§Ìä∏Í∞Ä 1Í∞úÏù¥ÎØÄÎ°ú Ïò§ÎçîÎü¨Í∞Ä 1Í∞úÏù¥Îã§.
PeerOrgs: # ÌîºÏñ¥ Ï°∞ÏßÅ
  - Name: Org1 # ÌîºÏñ¥ Ï°∞ÏßÅ Ïù¥Î¶Ñ
    Domain: org1.example.com # ÌîºÏñ¥ Ï°∞ÏßÅÏùò ÎèÑÎ©îÏù∏
    Template: # ÌîºÏñ¥Ïùò Í∞úÏàò
      Count: 1
    Users: # ÌîºÏñ¥ Ï°∞ÏßÅÏùò ÏÇ¨Ïö©Ïûê 1Î™Ö
      Count: 1
      
# 3Í∞ú + 4Í∞ú = 7Í∞úÏùò mspÍ∞Ä ÏÉùÏÑ±Îê®
ubuntu@ubuntu-jes:~/HLF/fabric-samples/basic-network$ tree | grep msp
‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬†         ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬†         ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬†                 ‚îú‚îÄ‚îÄ msp

```

first network Ïùò `crypto-config.yaml`(Ïù∏Ï¶ùÏóê Í¥ÄÌïú Ï†ïÎ≥¥Í∞Ä Îì§Ïñ¥ÏûàÎäî ÌååÏùº)

```yaml
OrdererOrgs: # Ïò§ÎçîÎü¨ Ï°∞ÏßÅ
  - Name: Orderer
    Domain: example.com
    EnableNodeOUs: true
    Specs: # Ïò§ÎçîÎü¨Í∞Ä 5Í∞úÍ∞Ä ÏûàÏùå
      - Hostname: orderer
      - Hostname: orderer2
      - Hostname: orderer3
      - Hostname: orderer4
      - Hostname: orderer5
PeerOrgs:
  - Name: Org1 # ÌîºÏñ¥ Ï°∞ÏßÅ 1
    Domain: org1.example.com
    EnableNodeOUs: true
    Template:
      Count: 2 # ÌîºÏñ¥ Ï°∞ÏßÅ 1Ïùò ÌîºÏñ¥ 2Í∞ú
    Users:
      Count: 1 # ÌîºÏñ¥ Ï°∞ÏßÅ 1Ïùò Ïú†Ï†Ä 1Î™Ö
  - Name: Org2 # ÌîºÏñ¥ Ï°∞ÏßÅ 2
    Domain: org2.example.com
    EnableNodeOUs: true
    Template:
      Count: 2 # ÌîºÏñ¥ Ï°∞ÏßÅ 2Ïùò ÌîºÏñ¥ 2Í∞ú
    Users:
      Count: 1 # ÌîºÏñ¥ Ï°∞ÏßÅ 2Ïùò Ïú†Ï†Ä 1Î™Ö
      
# 7Í∞ú + 5Í∞ú + 5Í∞ú = 17Í∞úÏùò mspÍ∞Ä ÏÉùÏÑ±Îê®
ubuntu@ubuntu-jes:~/HLF/fabric-samples/first-network$ tree | grep msp
‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬† ‚îÇ¬†¬†             ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬†     ‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬†     ‚îÇ¬†¬†         ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬†         ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬†         ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬†         ‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬†             ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ msp
‚îÇ¬†¬†                 ‚îú‚îÄ‚îÄ msp
```



MSPÏóê Îì§Ïñ¥Í∞ÄÎäî Ï†ïÎ≥¥ - P.63

```bash
CORE_PEER_LOCALMSPID=Org1MSP
CORE_PEER_ADDRESS=peer0.org1.example.com:7051
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt

CORE_PEER_LOCALMSPID=Org1MSP
CORE_PEER_ADDRESS=peer1.org1.example.com:8051
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer1.org1.example.com/tls/ca.crt

CORE_PEER_LOCALMSPID=Org2MSP
CORE_PEER_ADDRESS=peer0.org2.example.com:9051
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt

CORE_PEER_LOCALMSPID=Org2MSP
CORE_PEER_ADDRESS=peer1.org2.example.com:10051
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer1.org2.example.com/tls/ca.crt


peer chaincode install -n money -v 1.0 -p /opt/gopath/src/github.com/chaincode/fabcar/javascript/money.js -l node
peer chaincode instantiate -o orderer.example.com:7050 -C mychannel -n money -l node -v 1.0 -c '{"Args":[]}'
 -P "AND('Org1MSP.member','Org2MSP.member')" --tls
 --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
 --peerAddresses peer0.org1.example.com:7051
 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt

/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt
/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt


peer chaincode invoke \
    -o orderer.example.com:7050 \
    -C mychannel \
    -n fabcar2 \
    -c '{"function":"initToken","Args":["Hyechan","Dongwon","1000","200"]}' \
    --waitForEvent \
    --tls \
    --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem \
    --peerAddresses peer0.org1.example.com:7051 \
    --peerAddresses peer1.org1.example.com:8051 \
    --peerAddresses peer0.org2.example.com:9051 \
    --peerAddresses peer1.org2.example.com:10051 \
    --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \
    --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \
    --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt \
    --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
```



### Ï≤¥Ïù∏ÏΩîÎìú ÏÉùÏÑ± Ïãú

- package.json ÌååÏùºÏùÑ ÏÉùÏÑ±ÌïòÏûê. Í≤¨Î≥∏)

  ```js
  {
  	"name": "bhcmarble",
  	"version": "1.0.0",
  	"description": "bhcmarble chaincode implemented in node.js",
  	"engines": {
  		"node": ">=8.4.0",
  		"npm": ">=5.3.0"
  	},
  	"scripts": { "start" : "node bhcmarble.js" },
  	"engine-strict": true,
  	"license": "Apache-2.0",
  	"dependencies": {
  		"fabric-shim": "~1.4.0"
  	}
  }
  ```

- resultsIterator(Í≤∞Í≥º ÏßëÌï©Ï≤¥)