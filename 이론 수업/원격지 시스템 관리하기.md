# 원격지 시스템 관리하기

##  텔넷

- 텔넷은 가장 처음나온 서버-클라이언트
- 원격접속으로 많이 사용되었지만 보안이슈로 지금은 잘 쓰지않음
- 서버쪽엔 텔넷 서버, 클라이언트쪽엔 텔넷 클라이언트가 설치돼있어야함.

### 우리는 도커를 설치하는 법을 배웠으니 도커로 텔넷을 설치해보자.

```bash 
$ sudo docker run -it ubuntu:16.04

root@f7cf7912c804:/# apt-get update  
…
root@f7cf7912c804:/# apt-get install net-tools
…
# ifconfig
eth0      Link encap:Ethernet  HWaddr 02:42:ac:11:00:02  
          inet addr:172.17.0.2  Bcast:172.17.255.255  Mask:255.255.0.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:2595 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1781 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:16236860 (16.2 MB)  TX bytes:100670 (100.6 KB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

root@f7cf7912c804:/# 



# 로컬에서 텔넷을 실행해보자
ubuntu@server:~$ telnet
telnet> ^C
ubuntu@server:~$ 
# 텔넷 커맨드창이 뜬다. 텔넷 클라이언트가 깔려있다는 것을 의미한다.

# 로컬에서 컨테이너로 텔넷을 요청해보자.
ubuntu@server:~$ telnet 172.17.0.2
Trying 172.17.0.2...
telnet: Unable to connect to remote host: Connection refused
# 방화벽 설정이 되어있거나 텔넷 서버가 깔려있지않아있다.

# telnetd 설치
root@f7cf7912c804:/# dpkg -l xinetd
dpkg-query: no packages found matching xinetd
root@f7cf7912c804:/# apt-get install -y xinetd telnetd
      :
      :
root@f7cf7912c804:/etc/xinetd.d# cd /etc/xinetd.d/
root@f7cf7912c804:/etc/xinetd.d# touch telnet

# telnet 수정 및 실행
root@f7cf7912c804:/etc/xinetd.d# apt-get install vim
root@f7cf7912c804:/etc/xinetd.d# vim telnet

service telnet
{
	disable = no
	flags = REUSE
	socket_type = stream
	wait = no
	user = root
	server = /usr/sbin/in.telnetd
	log_on_failure += USERID
}

// xinetd 재시작
root@f7cf7912c804:/etc/xinetd.d# service xinetd restart 
또는
root@f7cf7912c804:/etc/xinetd.d# systemctl restart xinetd





# 사용자 추가 

root@f7cf7912c804:/etc/xinetd.d## adduser teluser
root@f7cf7912c804:/etc/xinetd.d## passwd teluser





# 원격 접속 확인
컨테이너 밖에 있는 터미널에서 컨테이너 IP(172.17.0.2 )로 telnet 접속
$ telnet 172.17.0.2

ubuntu@ubuntu:~$ telnet 172.17.0.2
Trying 172.17.0.2...
Connected to 172.17.0.2.
Escape character is '^]'.
Ubuntu 16.04.6 LTS
f7cf7912c804 login: teluser
Password: 
Last login: Sun Jun 16 13:16:43 UTC 2019 from 172.17.0.1 on pts/1
Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.15.0-45-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage
teluser@f7cf7912c804:~$ 

// 테스트 파일 생성
teluser@f7cf7912c804:~$ touch test1234




# telnet 서버 컨테이너에서 test1234 파일이 생성되었는지 확인

root@f7cf7912c804:~# cd /home/teluser/
root@f7cf7912c804:/home/teluser# ls
test1234 
root@f7cf7912c804:/home/teluser# 



```

## Open SSH 서버 구축

```bash
#텔넷 서버에 openssh 서버 같이 구축

# openSSH 설치 // ubuntu 16.04 도커 컨테이너에 접속 후 openssh-server설치

$ sudo apt-get install -y openssh-server

# ssh 서버 재시작
root@82b7b545a445:~# service ssh restart


# 로컬 ubuntu에서 도커 컨테이너로 ssh 접속
$ ssh teluser@172.17.0.2  

```



## VNC 서버(p.467~476)

- X window 기반 원격 접속

- 우분투 가상머신 두개가 필요 (도커 아님)

```bash
// 가상머신 1 
$ sudo apt-get install vnc4server



## DNS 서버

# name 서버 동작 확인

$ nslookup
> server
Default server: 127.0.1.1
Address: 127.0.1.1#53
> www.nate.com
Server:		127.0.1.1
Address:	127.0.1.1#53

Non-authoritative answer:
Name:	www.nate.com
Address: 120.50.131.112
> www.naver.com
Server:		127.0.1.1
Address:	127.0.1.1#53

Non-authoritative answer:
www.naver.com	canonical name = www.naver.com.nheos.com.
Name:	www.naver.com.nheos.com
Address: 210.89.160.88
Name:	www.naver.com.nheos.com
Address: 210.89.164.90
> www.kernel.org
Server:		127.0.1.1
Address:	127.0.1.1#53

Non-authoritative answer:
www.kernel.org	canonical name = git.kernel.org.
git.kernel.org	canonical name = sin.git.kernel.org.
Name:	sin.git.kernel.org
Address: 147.75.46.191
> 




# 네임 서버 설정 파일 확인 (/etc/resolv.conf)

$ cat /etc/resolv.conf 
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
nameserver 127.0.1.1
search localdomain




# 네임 서버 설정 주석처리

# 동작확인

# /etc/host 파일 수정

# 동작 확인

```



## 팀뷰어

훨씬 좋음 이거쓰자



## 네임 서버(p.480~)

```bash
ubuntu@server:~$ cat /etc/hosts
127.0.0.1	localhost
127.0.1.1	server

# The following lines are desirable for IPv6 capable hosts
::1     ip6-localhost ip6-loopback
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
ubuntu@server:~$ nslookup
> www.google.com
Server:		127.0.1.1
Address:	127.0.1.1#53

Non-authoritative answer:
Name:	www.google.com
Address: 216.58.197.132
> google.com
Server:		127.0.1.1
Address:	127.0.1.1#53

Non-authoritative answer:
Name:	google.com
Address: 216.58.197.174
> www.nate.com
Server:		127.0.1.1
Address:	127.0.1.1#53

Non-authoritative answer:
Name:	www.nate.com
Address: 120.50.131.112
> naver.com
Server:		127.0.1.1
Address:	127.0.1.1#53

Non-authoritative answer:
Name:	naver.com
Address: 125.209.222.141
Name:	naver.com
Address: 125.209.222.142
Name:	naver.com
Address: 210.89.164.90
Name:	naver.com
Address: 210.89.160.88
> exit

$ cat /etc/resolv.conf 
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
nameserver 127.0.1.1
search localdomain

```



## Mariadb 서버

```bash
// docker ubuntu 실행

$ sudo docker run -it ubuntu:16.04

// repository 추가 
# apt -y install software-properties-common dirmngr
# apt-key adv --recv-keys --keyserver hkp://keyserver.ubuntu.com:80 0xF1656F24C74CD1D8
# add-apt-repository 'deb [arch=amd64] http://mirror.zol.co.zw/mariadb/repo/10.3/ubuntu xenial main'
# apt update

// Mariadb server, client 설치
# apt -y install mariadb-server mariadb-client




## Docker hub 를 통한 Mariadb 설치
ubuntu@server:~$ sudo docker run --name bangdb -e MYSQL_ROOT_PASSWORD=passwd -d mariadb:10-bionic
e3726e0d2c5f8e4793c30935c6173b7dd1af85383b6b625a7be43672eaef2242

# mysql 호스트 옵션에 컨테이너 이름을 사용하려면 링크를 해줘서 테이블에 등록을 시켜줘야 한다.(컨테이너id도 가능)
ubuntu@server:~$ sudo docker run -it --link bangdb --rm mariadb mysql -hbangdb -uroot -pEnter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 8
Server version: 10.3.15-MariaDB-1:10.3.15+maria~bionic mariadb.org binary distribution

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
+--------------------+
3 rows in set (0.001 sec)

MariaDB [(none)]> 

# 링크를 안해주고 ip어드레스를 알려줘도 된다.
ubuntu@server:~$ sudo docker run -it --rm mariadb mysql -h172.17.0.2 -uroot -p
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 9
Server version: 10.3.15-MariaDB-1:10.3.15+maria~bionic mariadb.org binary distribution

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]> 

# p 옵션에 바로 패스워드를 입력해줄수도 있다.
ubuntu@server:~$ sudo docker run -it --rm mariadb mysql -h172.17.0.2 -uroot -ppasswd
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 10
Server version: 10.3.15-MariaDB-1:10.3.15+maria~bionic mariadb.org binary distribution

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]> 


```

