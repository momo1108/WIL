컨테이너를 이용하기 위해선 틀이 있어야한다. → Image

![](/image/docker.jpg)



​          



## 도커 레파지토리를 추가

\# gedit /etc/apt/sources.list

deb https://apt.dockerproject.org/repo ubuntu-xenial main

## HTTPS 통신에 사용되는 패키지와 공개키를 설치

**\# apt-get install -y apt-transport-https ca-certificates curl gnupg-agent software-properties-common**

패키지 목록을 읽는 중입니다... 완료

의존성 트리를 만드는 중입니다       

상태 정보를 읽는 중입니다... 완료

apt-transport-https is already the newest version (1.2.10ubuntu1).

apt-transport-https 패키지는 수동설치로 지정합니다.

ca-certificates is already the newest version (20160104ubuntu1).

ca-certificates 패키지는 수동설치로 지정합니다.

curl is already the newest version (7.47.0-1ubuntu2).

curl 패키지는 수동설치로 지정합니다.

gnupg-agent is already the newest version (2.1.11-6ubuntu2).

gnupg-agent 패키지는 수동설치로 지정합니다.

software-properties-common is already the newest version (0.96.20).

software-properties-common 패키지는 수동설치로 지정합니다.

0개 업그레이드, 0개 새로 설치, 0개 제거 및 0개 업그레이드 안 함.

**\# apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D**

Executing: /tmp/tmp.XkzJ6mLu4r/gpg.1.sh --keyserver

hkp://p80.pool.sks-keyservers.net:80

--recv-keys

58118E89F3A912897C070ADBF76221572C52609D

gpg: requesting key 2C52609D from hkp server p80.pool.sks-keyservers.net

gpg: key 2C52609D: public key "Docker Release Tool (releasedocker) <docker@docker.com>" imported

gpg: Total number processed: 1

gpg:               imported: 1  (RSA: 1)

**\# apt-get update**

linux-image-extra와 docker-engine 패키지를 설치

**\# apt-get install linux-image-extra-$(uname -r)**

**\# apt-get install docker-engine**

**root@server:/etc/apt# docker version**

Client:

 Version:      17.05.0-ce

 API version:  1.29

 Go version:   go1.7.5

 Git commit:   89658be

 Built:        Thu May  4 22:10:54 2017

 OS/Arch:      linux/amd64

Server:

 Version:      17.05.0-ce

 API version:  1.29 (minimum version 1.12)

 Go version:   go1.7.5

 Git commit:   89658be

 Built:        Thu May  4 22:10:54 2017

 OS/Arch:      linux/amd64

 Experimental: false

**root@server:~# cd**
**root@server:~# mkdir docker**
**root@server:~# cd docker/**

**root@server:~/docker# gedit main.go**

package main

import (
        "fmt"
        "log"
        "net/http"
)

func main() {
        http.HandleFunc("/", func (w http.ResponseWriter, r *http.Request) {
                log.Println("received request")
                fmt.Fprintf(w, "I have to see a Docker !!!")
        })
        log.Println("start server")

        server := &http.Server{Addr: ":8080"}
        if err := server.ListenAndServe(); err != nil {
                log.Println(err)
        }
}

**root@server:~/docker# gedit dockerfile**

FROM golang:1.9



RUN mkdir /echo



COPY main.go /echo



CMD [ "go", "run", "/echo/main.go" ]

**root@server:~/docker# docker image build -t example/echo:latest . **

Sending build context to Docker daemon  3.072kB

Step 1/4 : FROM golang:1.9

1.9: Pulling from library/golang

55cbf04beb70: Pull complete 

1607093a898c: Pull complete 

9a8ea045c926: Pull complete 

d4eee24d4dac: Pull complete 

9c35c9787a2f: Pull complete 

8b376bbb244f: Pull complete 

0d4eafcc732a: Pull complete 

186b06a99029: Pull complete 

Digest: sha256:8b5968585131604a92af02f5690713efadf029cc8dad53f79280b87a80eb1354

Status: Downloaded newer image for golang:1.9

 ---> ef89ef5c42a9

Step 2/4 : RUN mkdir /echo

 ---> Running in 28fc48e76b1a

 ---> 024d93e00764

Removing intermediate container 28fc48e76b1a

Step 3/4 : COPY main.go /echo

 ---> 9536233ba248

Removing intermediate container d660cc064687

Step 4/4 : CMD go run /echo/main.go

 ---> Running in e58fc269864c

 ---> 6775e8903765

Removing intermediate container e58fc269864c

Successfully built 6775e8903765

Successfully tagged example/echo:latest

**root@server:~/docker# docker image ls**

REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE

example/echo        latest              6775e8903765        4 minutes ago       750MB

golang              1.9                 ef89ef5c42a9        10 months ago       750MB

**root@server:~/docker# docker image build -t example/echo:latest . **

Sending build context to Docker daemon  3.072kB

Step 1/4 : FROM golang:1.9

 ---> ef89ef5c42a9

Step 2/4 : RUN mkdir /echo

 ---> Using cache

 ---> 024d93e00764

Step 3/4 : COPY main.go /echo

 ---> 76b9aa0125fe

Removing intermediate container 1a437913aa6f

Step 4/4 : CMD go run /echo/main.go

 ---> Running in 891755cd6071

 ---> 8da1dcd16f94

Removing intermediate container 891755cd6071

Successfully built 8da1dcd16f94

Successfully tagged example/echo:latest

root@server:~/docker# docker image ls

REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE

example/echo        latest              8da1dcd16f94        52 seconds ago      750MB

<none>              <none>              6775e8903765        9 minutes ago       750MB

golang              1.9                 ef89ef5c42a9        10 months ago       750MB

root@server:~/docker# 

**root@server:~/docker# docker container run -d -p 9000:8080 example/echo:latest**

**root@server:~/docker# docker container rm -f b**

**root@server:~/docker# docker container run -it -p 9000:8080 -d example/echo:latest /bin/bash**

**root@server:~/docker# doker attach 09**

**root@0915e6220036:/go# exit**

**root@server:~/docker# docker container ps -a**

**root@server:~/docker# docker container restart 09**

**root@server:~/docker# docker container run -p 9002:80 --name web1 nginx**

**root@server:~/docker# docker container ps -a --filter "ancestor=example/echo"**

**root@server:~/docker# docker container rm -f $(docker container ps -q -a --filter "ancestor=example/echo")**
33433cf771cb
2908b5fb06d8
6e64a7a35424

**root@server:~/docker# docker login**

**root@server:~/docker# docker system prune**
WARNING! This will remove:

all stopped containers

all volumes not used by at least one container

all networks not used by at least one container

all dangling images
Are you sure you want to continue? [y/N] y
Total reclaimed space: 0B
root@server:~/docker# docker container run -d -p 9000:80 nginx
Unable to find image 'nginx:latest' locally
latest: Pulling from library/nginx
743f2d6c1f65: Pull complete 
6bfc4ec4420a: Pull complete 
688a776db95f: Pull complete 
Digest: sha256:23b4dcdf0d34d4a129755fc6f52e1c6e23bb34ea011b315d87e193033bcd1b68
Status: Downloaded newer image for nginx:latest
14fee3e1be65231e649a402344061a3ccc09724805b5df6b2af54b8872935c32
root@server:~/docker# docker container ls
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES
14fee3e1be65        nginx               "nginx -g 'daemon ..."   13 seconds ago      Up 12 seconds       0.0.0.0:9000->80/tcp   quizzical_brattain
**root@server:~/docker# docker container exec 1 ls /usr/share/nginx/html/**
50x.html
index.html
**root@server:~/docker# docker container cp 1:/usr/share/nginx/html/index.html /root/docker**
**root@server:~/docker# ls**
dockerfile  index.html  main.go
**root@server:~/docker# nano index.html**
**root@server:~/docker# docker container cp ./index.html 1:/usr/share/nginx/html/index.html**

특정 이름의 컨테이너를 조회

**\# docker container ls -a --filter="name=ooo"**

특정 이름의 컨테이너를 삭제

**\# docker container rm -f $(docker container ls -aq --filter="name=ooo")**

특정 이름의 컨테이너를 삭제하고 해당 이름의 컨테이너를 실행

**\# docker container rm -f $(docker container ls -aq --filter="name=ooo") ; docker container run --name ooo IMAGE_NAME**

실행 또는 중지 상태의 컨테이너를 모두 강제로 삭제

**root@server:~/docker# docker container rm -f $(docker container ls -aq)**

모든 이미지를 삭제

**root@server:~/docker# docker image rm $(docker image ls -aq)**

**root@server:~/docker# cat Dockerfile **

FROM golang:1.9

RUN mkdir /echo

COPY main.go /echo

CMD [ "go", "run", "/echo/main.go" ]

echo라는 이름의 도커 이미지 생성

**root@server:~/docker# docker build -t echo .**

호스트의 9090 포트를 컨테이너의 8080 포트로 맵핑해서 컨테이너를 실행

**root@server:~/docker# docker container run -p 9090:8080 -d echo**

4daae1153e8f1959a6db7b6b94b4ba65f60d002c55d2514852060348b1949155

컨테이너 상태를 확인 (실행 여부)

**root@server:~/docker# docker container ps **

CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES

4daae1153e8f        echo                "go run /echo/main.go"   13 seconds ago      Up 12 seconds       0.0.0.0:9090->8080/tcp   amazing_snyder

컨테이너에 서비스를 요청

**root@server:~/docker# curl http://localhost:9090**

Hello Docker ^^ !!!

컨테이너에 파일을 가져와서 수정 후 재실행

컨테이너의 /echo/main.go 파일을 호스트의 ./main2.go 파일로 복사

**root@server:~/docker# docker container cp 4da:/echo/main.go ./main2.go**

**root@server:~/docker# ls main2.go**

main2.go

호스트에서 ./main2.go 파일의 내용을 수정

**root@server:~/docker# gedit main2.go**

호스트의 ./main2.go 파일을 컨테이너의 /echo/main.go 파일로 복사

**root@server:~/docker# docker container cp ./main2.go 4da:/echo/main.go**

컨테이너가 재실행되지 않았으므로 변경된 내용이 반영되지 않았음

**root@server:~/docker# curl http://localhost:9090**

Hello Docker ^^ !!!

root@server:~/docker# 

컨테이너의 실행을 중지하고 재실행

**root@server:~/docker# docker container stop 4da**

4da

**root@server:~/docker# docker container start 4da**

4da

수정한 내용이 반영된 것을 확인

**root@server:~/docker# curl http://localhost:9090**

안녕 도커 !!!

root@server:~/docker#