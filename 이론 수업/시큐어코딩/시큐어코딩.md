책 그대로

## 1. 안전한 소프트웨어 개발 방법론

> ### 1. 시큐어 코딩의 개요
>
> ### 2. 개발보안 방법론



## 2. 안전한 소프트웨어를 만드는 시큐어코딩 기법

> ### 3. 웹 애플리케이션 보안을 위한 기본 지식
>
> ### 4. 보안취약점 제거를 위한 코딩 기법
>
> ### 5. 안전하지 않은 코딩 스타일



## 3. 소프트웨어 보안 강화 기법

> ### 6. 오픈소스 보안 라이브러리 활용
>
> ### 7. 보안약점 진단 도구 활용

### 		　

### 1-1 시큐어코딩의 개요

- 소프트웨어 개발보안의 필요성
- 침해 사고 사례
- 보안취약점 정보 활용
- 행정자치부 소프트웨어 개발보안 가이드



#### 파일 업로드 취약점(개인정보 유출의 가장 큰 원인)

- 파일 업로드 기능을 제공하는 사이트에서업로드 파일의 크기와 개수를 제한하지 않음
  - 서버의 연결 및 디스크 자원을 고갈시킨다. ⇒ 정상적인 서비스를 방해 ⇒ DoS
- 업로드 파일의 종류를 제한하지 않음
  - 서버에서 실행 가능한 웹쉘(WebShell) 파일을 업로드 후 해당 파일을 실행해서 서버의 제어권을 탈취
  - 악성코드가 포함된 실행파일을 업로드 후 불특정 다수가 다운로드하도록 유도 ⇒ 악성코드 유포지로 악용
- 외부에서 접근 가능한 경로에 파일을 저장하는 경우에 발생하는 취약점

#### 방어기법

- 업로드 파일의 크기와 개수를 제한
- 업로드 파일의 종류를 제한
- 외부에서 접근할 수 없는 경로에 업로드 파일을 저장
- 업로드 파일의 저장 경로와 파일명을 외부에서 알 수 없도록 한다.
- 업로드 파일의 실행 속성을 제거한 후 저장한다.



#### SSL

취약점 : Heart Bleed https://blog.alyac.co.kr/76



#### SQL Injection

- SQL 명령에 사용된 특별한 엘리먼트를 무효화하지 않는 것 (SQL Injection)
- SQL문 예약어 또는 특수기호 ⇒ 메타문자(어떤 기능에서 의미를 가지고 있는 문자)
- 이스케이프 = 메타문자(의미문자)에서 의미를 제거하고 문자만 남기는 것
- 외부 입력값을 쿼리 조작 문자열 포함 여부를 확인하지 않고, 쿼리 생성 및 실행에 사용하는 경우 발생 → 원리 의미와 다른 형태로 쿼리가 변형되어서 실행되는 것 



#### 운영체제 명령어 삽입 (Command Injection)

- 운영체제 명령어 실행 부분이 존재하는 경우, 외부 입력값을 검증, 제한하지 않고, 명령어 또는 명령어의 일부로 사용하는 경우 발생

  ```java
  // 외부 입력값을 검증, 제한하지 않고, 명령어로 사용하는 경우
  String cmd = request.getParameter("cmd");
  Runtime.getRuntime().exec(cmd); 
  
  // 외부 입력값을 검증, 제한하지 않고, 명령어의 일부(명령어의 파라미터)로 사용하는 경우 ⇒ 의도하지 않은 추가 명령어 실행이 가능
  String file = request.getParameter("file");
  Runtime.getRuntime().exec("type c:\\data\" + file); 
  // c:\\data\ 아래에 존재하는 파일의 내용을 콘솔에 출력
  ```



#### 크로스 사이트 스크립팅(XSS = Cross-site Scripting)

- <u>웹 페이지 생성</u>에 사용된 <u>입력값 검증이 이뤄지지 않은 것</u>
  - 동적 페이지
  - 입력값이 페이지 생성에 사용되었음
  - 입력값에 실행 가능한 코드가 포함되었음

- <u>공격자가 전달한 스크립트 코드</u>가 사용자 브라우저를 통해서 실행되는 것
  1. 저장 XSS (Stored)
  2. 반사 XSS (Reflective)

![](./image/1.jpg)

```jsp
<%
	// 입력값에 포함된 태그 요소(< >)를 HTML 인코딩 처리해서 출력한다.
	// <script>..</script> ⇒ &lt;script&gt;..&lt;/script&gt;
	String input = request.getParameter("id");
	if (input != null) {
		input = input.replaceAll("<", "&lt;");
		input = input.replaceAll(">", "&gt;");
	}
%>
"<%=input>"는 존재합니다.
```



#### 사이트간 요청위조 = 크로스 사이트 요청위조 = CSRF(Cross-Site Request Forgery)

- 요청을 받은 서버측 프로그램이 요청 주체와 요청 절차를 검증하지 않고 요청을 처리했을 때 발생

![](./image/2.jpg)



#### Open Redirect 

- 신뢰되지 않은 URL 주소로 자동 접속 연결외부 입력값을 검증, 제한 없이 리다이렉트 주소로 사용하는 경우 발생
-  의도하지 않은(계획되지 않은) 외부 사이트로 리다이렉션이 발생할 수 있음

![](./image/3.jpg)

mypage.jsp
요청 : mypage.jsp?url=main.jsp ⇒ 응답 : main.jsp 

```jsp
<%@ page language="java" contentType="text/html; charset=EUC-KR"
    pageEncoding="EUC-KR"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
<title>Insert title here</title>
</head>
<body>
여기는 redirect.jsp 입니다.
<%
	String url = request.getParameter("url");
	if(url != null) {
		response.sendRedirect(url);
	}
%>
</body>
</html>
```

http://localhost:8080/openeg/Redirect.jsp?url=cors.html

- url을 직접 입력해주면 그쪽으로 redirect됨



#### 경로추적외부

- 입력값을 경로조작 문자열 포함 여부를 확인하지 않고, 내부 파일 참조에 사용하는 경우 발생
  - 정상 요청 : download.jsp?file_name=abc.gif ⇒ /upload/data/2019/08/abc.gif 파일을 다운로드 처리
  - 비정상 요청 : download.jsp?file_name=../../../../../../../../../etc/passwd ⇒ /ect/passwd 파일을 다운로드 처리
- 권한 밖의 파일에 접근이 가능
- 지정된 경로 밖의 파일에 접근이 가능



### 위협 모델링

1. 팀소집 - 팀원, 팀리더
2. 어플리케이션 **분해** → 위협목표 식별
3. ★★★**위협결정(위협트리)** ← **분류(STRIDE)** ← 식별
4. ★★★**위험도 산정(DREAD)** → 우선순위 결정
5. 대응방법 결정 : 무시, 알림, 고침(기능을 수정해서 사용가능), 제거(기능자체를 삭제)
6. 적용 기법·기술 선택



cgi → servlet → mvc 프레임워크