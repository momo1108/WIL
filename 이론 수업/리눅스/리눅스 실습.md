# 리눅스

Shell 은 os와 사용자간의 메세지를 전달

암호화된 패스워드가 /etc/passwd가 아닌 /etc/shadow에 저장되는 이유

다른 사용자가 passwd는 볼 수있지만 shadow는 볼 수 없다.

shadow파일의 내용 중 줄의 마지막 항목 쉘의 경우 /bin/bash는 원격 접속이 가능하지만 /bin/false는 원겹 접근을 막는 역할을 한다.

# 리눅스 실습

- mount ⇐ VMware Tools CD의 마운팅 경로를 확인

-  cd /media/root/VMware\ Tools



- 리눅스에서는 띄워쓰기가 명령어와 서브명령어를 구분하는 역할을 한다.

- 따라서 cd명령어를 사용할 때 폴더 명에 띄워쓰기가 있으면 공백을 명령어가 아닌 폴더명의 일부로 인식하기 위해 \를 사용해서 escape를 해준다.



- cp *.gz /tmp ⇐ 설치 파일을 작업 디렉터리로 복사

- cd /tmp ⇐ 작업 디렉터리로 이동

- tar -xvf VMware[TABKEY]

- cd vmare[TABKEY]

- ./vmware-install.pl

- 첫번째 질문에 yes를 입력하고 나머지는 엔터(디폴트로 설치)

- 끝나고 나면 reboot



# vi 편집기

vi → 명령어 모드

![](https://cau-dosc.github.io/images/vi-mode-switching.PNG)

- 명령어 모드에서 i(현재커서부터 입력), a(커서다음부터 입력)를 입력하면 편집모드로 들어간다
- 편집모드에서 명령어 모드로 들어오려면 esc키를 누른다.
- 명령어 모드에서 라인명령모드로 들어가려면 : 을 입력한다. 역시 돌아오려면 esc를 누른다.
  - :q (종료) :w (저장) :wq (저장 후 종료) : q!(강제로 종료)
  - /ba ☞ ba로 시작하는 문자열을 찾는다. 다음 문자열 찾기 - n
  - vi편집기를 사용하여 편집하는 도중에 터미널이 종료되면 그 파일의 임시저장(swp)파일이 저장된다.
  - 임시저장 파일은 숨김파일이다. ls -a로 볼 수 있다. linux의 숨김파일은 이름 앞에 . 이 붙는다.



# 명령어 프롬프트

사용자@호스트 : 경로 $#

ex) root@Server-b:~#

명령어들(p.140)

종료하는 방법

- poweroff, shutdown -P now, halt -p, <u>init 0</u>

시스템 재부팅

- shutdown -r now, reboot, <u>init 6</u>

로그아웃

- logout, exit

자동 완성

- tab

도스 키

- 방향키 위아래를 누르면 이전에 입력한 명령어로 다시 나타낼 수 있다.

history

- 여태까지 사용한 명령어들의 이력

공유폴더를 설정하고 찾아보자

- VM-세팅-Option-Shared Folders 를 enable해준다.
- root@server:/# mount | grep hgfs
- vmhgfs-fuse on /mnt/hgfs type fuse.vmhgfs-fuse (rw,nosuid,nodev,relatime,user_id=0,group_id=0,allow_other)
- 경로내에 지정해준 공유 폴더가 있다.

도움말(사용법) 명령어 man

- --help 옵션을 쓸 수도 있지만 man 명령어를 통해 확인할 수도 있다.
- ex) man vi
- 모든 명령어가 man을 지원하는것은 아니다.

## 마운트와 CD/DVD 및 USB의 활용★

- 마운트 - 물리적인 장치를 특정한 위치(대개는 디렉터리)에 연결시켜 주는 과정

- mount 명령어로 현재 마운트된 장치들을 확인할 수 있다.

- umount 명령어를 입력해서 마운트를 해제할 수 있다.

- umount /dev/cdrom 으로 cdrom이 언마운트된다.

- cdrom 세팅을 다시 설정해주고 connect해주면 다시 마운트된다.

- 현재의 작업중인 디렉터리 위치가 cdrom 내부이면 umount명령어가 먹히지 않는다. 

- USB를 연결하고 VMware 아래 작업표시줄에서 USB를 connect 해준다.

- mount 명령어를 실행해서 USB의 경로를 확인해본다.

- 언마운트 명령어를 실행해서 USB를 언마운트 하면 탐색기창에 USB가 없어진다.    umount /dev/sdg1

- DVD/USB 마운트를 완전히 해제하려면 다시 VMware 아래 작업표시줄에서 disconnect 해준다.

- 혹시라도 USB가 마운트 되지 않는다면 USB가 꽃힌 PC의 포트 버전과

  VMware의 USB 버전이 일치하는지 확인해준다.

- 텍스트모드의 서버에서도 진행을 해보자(p.169~)

- 일단 우분투서버에서는 마운트할 경로를 생성해주어야 한다.

  1. cdrom을 만들어보자

     - 처음엔 mount를 해보아도 cdrom이 확인되지 않는다.

     - mkdir /media/cdrom 으로 경로를 생성해준다.

     - VMware 설정에서 cdrom 에 이미지 파일을 넣어주고 connect 해준다.

     - cdrom의 기본 경로인 /dev/cdrom을 생성한 경로 /media/cdrom으로 마운트해준다.

       mount /dev/cdrom /media/cdrom

     - /media/cdrom에 우분투 이미지파일이 마운트된 것을 볼 수 있다.

     - 언마운트를 하면 경로안에 마운트된 내용이 다 없어진다.

       umount /media/cdrom

       umount /dev/cdrom

  2. usb를 만들어보자

     - 처음엔 mount를 해도 usb가 확인되지 않는다.

     - mkdir /media/usb 로 경로를 생성

     - VMware 설정에서 usb를 connect해준다.

     - usb의 기본 경로인 /dev/usb를 생성한 경로 /media/usb로 마운트해준다.

       mount /dev/sdb1 /media/usb

     - /media/usb에 usb안의 파일들이 마운트된 것을 볼 수 있다.

     - 언마운트를 하면 경로안에 마운트된 내용이 다 없어진다.

       umount /media/usb

       umount /dev/sdb1

  3. iso 파일을 직접 생성하고 마운트해보자

     - 먼저 genisoimage라는 프로그램을 설치해주어야 한다.

     - 설치되어있는지 확인해보자.

       dpkg --get-selections genisoimage

     - 설치가 되어있지 않은 경우 직접 설치해준다.

       apt-get install -y genisoimage

     - 이제 genisoimage 프로그램을 이용하여 iso파일을 만들고 마운트할 경로를 만들어보자.

       genisoimage -r -J -o boot.iso(생성할 ISO파일 이름) /boot(포함될 파일 또는 디렉터리)

       mkdir /media/iso

     - ls -l 로 생성된 iso파일을 확인해본다.

     - 생성된 iso 파일을 마운트해주고 파일 내용을 비교해본다.

       mount -o loop boot.iso /media/iso

       ll /media/iso

       ll /boot

     - 언마운트를 하면 경로안에 있던 내용들이 다 없어지는 것이다.

       umount /media/iso

       or     umount /root/boot.iso

     - 터미널에서는 x-윈도우처럼 자동으로 마운트되는 플러그 앤 플레이 기능을 지원하지 않기 때문에 전원이 꺼지면 마운트되었던 파일들이 언마운트된 상태로 유지가 된다. 그러므로 재부팅을 해도 마운트가 되지 않고 언마운트 된 채로 유지가 된다. 

- 기본 명령어

  - ls
    - Windows의 dir같은 역할, 해당 디렉터리의 파일목록 나열
  
      ex)   # ls /etc/systemd
  
  - cd
    
  - 디렉터리를 이동
    
    ex)   # cd ../etc/systemd
    
  - 절대경로와 상대경로를 이해하자
    
    현재 경로가 /etc 일 경우
    
    cd /data 의 결과는 root@server:/data/#
    
    cd ./data 의 결과는 root@server:/etc/data#
    
  - pwd
    
  - 현재 디렉터리의 전체 경로를 출력
    
  - rm
    
  - 파일이나 디렉터리를 삭제
    
    ex)   # rm -rf abc
    
  - cp
    - 파일이나 디렉터리를 복사
  
        해당 파일의 읽기권한이 필요
  
        ex)   # cp abc.txt cba.txt
  
  - touch
    - 크기가 0인 새 파일을 생성, 이미 존재하는 경우 수정 시간을 변경
  
      ex)   # touch abc.txt
  
  - mv
    - 파일과 디렉터리의 이름을 변경, 위치 이동시 사용
  
      ex)   # mv abc.txt www.txt
  
      \# mv aaa bbb ccc ddd		aaa,bbb,ccc 파일을 /ddd 디렉터리로 이동
  
  - mkdir
    - 새로운 디렉터리를 생성
  
      ex)   # mkdir abc   \# mkdir -p abc/xxx/yyy/zzz (부모 디렉터리가 없을경우 자동 생성) 	abc/xxx/yyy가 없을 경우 자동으로 생성해준다.
  
  - rmdir
    - 디렉터리를 삭제
  
      삭제 권한이 있어야 하며, 디렉터리는 비어 있어야 함.
  
      들어있는 경우 rm -r 을 사용
  
  - cat
    - 여러개 파일을 나열하면 파일을 연결해서 보여준다.
  
      ex)   # cat a.txt b.txt
  
  - head, tail
    - 텍스트 형식으로 작성된 파일의 앞 10행 또는 마지막 10해만 화면에 출력
  
      ex)   # head /etc/systemd/bootchart.conf
  
      \# head -3 /etc/systemd/bootchart.conf → 앞 3행만 화면에 출력
  
      \# tail -5 /etc/systemd/bootchart.conf → 마지막 5행만 화면에 출력
  
  - more
    - 텍스트 형식으로 작성된 파일을 페이지 단위로 화면에 출력
  
    - 다음 페이지 Space bar      앞 페이지 B      종료 Q
  
      ex)   # more +10 /etc/systemd/system.conf → 10행부터 출력
  
  - less
    - more과 비슷하지만 더 확장됨. more에서 사용하는 키도 사용가능, 
  
      Page Up, Page Down 사용 가능
  
      ex)   # less +10 /etc/systemd/system.conf → 10행부터 출력
  
  - file
    - 해당 파일이 어떤 종류의 파일인지 표시
  
      ex)   # file /etc/systemd/system.conf → 텍스트 파일이므로 ASCII로 표시됨
  
  - clear
  
    - 현재 사용 중 터미널 화면을 깨끗하게 지워줌
  
  - \>
    - redirect 명령어로 앞쪽에 있는 파일의 내용이나 명령어의 결과를 오른쪽에 생성한 파일에 집어넣는다.
  
      ex)   # cat aaa bbb > all

# 런 레벨 ★

p.144

ln 명령어

- 링크를 거는 명령어
- run level에서 사용해서 default.target을 여러 run level로 바꿔본다.



# 사용자와 그룹(p.179)

## 사용자 그룹

- 리눅스는 다중 사용자 시스템(Multi-User System)
- root : 기본제공계정으로 모든 작업 권한을 가진 수퍼유저
- 모든 사용자는 하나 이상의 그룹에 소속
- 계정 정보는 /etc/passwd 파일에 정의
  - 사용자 이름 : 암호 : 사용자 ID : 사용자가 소속된 주 그룹 ID : 추가 정보 : 홈 디렉터리 : 기본 쉘
- /etc/passwd 파일에 패스워드가 x로 표시된 경우 /etc/shadow 파일에 암호화되어 저장되어 있는것
- 그룹 정보는 /etc/group 파일에 정의
  - 그룹 이름 : 비밀번호 : 그룹 id : 보조 그룹 사용자

- 관련 명령어
  - adduser
    - 사용자 추가
    - 사용자 생성시 별도의 그룹을 지정하지 않으면, 자동으로 사용자 이름과 동일한 그룹이 생성되고 자동으로 포함된다.
  - passwd
    - 사용자 비밀번호 지정, 변경
  - usermod
    - 사용자 속성 변경
  - userdel
    - 사용자 삭제
    - -r : recursive -f : force
  - chage
    - 암호를 주기적으로 변경하도록 설정
  - groups
    - 사용자나 명령어의 대상이 소속된 그룹을 보여줌
  - groupadd
    - 새로운 그룹을 생성
  - groupmod
    - 그룹의 속성을 변경
  - groupdel
    - 그룹을 삭제
  - gpasswd
    - 그룹의 암호를 설정, 그룹 관리를 수행
- /etc/skel 디렉터리에 파일을 넣어놓으면 새로운 사용자가 생성될 때 홈 디렉터리에 복사하는 작업이 발생한다.

## 파일과 디렉터리의 소유와 허가권

- 리눅스는 각각의 파일과 디렉터림다 소유권과 허가권이라는 속성이 있다.

| 파일 유형 | 파일 허가권 | 링크 수 | 파일 소유자 이름 | 파일 소유그룹 이름 | 파일 크기(Byte) | 마지막 변경 날짜/시간 | 파일 이름  |
| --------- | ----------- | ------- | ---------------- | ------------------ | --------------- | --------------------- | ---------- |
| -         | rw-r--r--   | 1       | root             | root               | 0               | 7월 15 16:11          | sample.txt |

- 파일 유형

  - 디렉터리 : d
  - 일반 파일 : -
  - 블록 디바이스 : b     문자 디바이스 : c     링크 : l

- chmod 명령

  - 파일 허가권 변경 명령어

- 파일 소유권(Ownership)

  - 파일을 소유한 사용자와 그룹

- chown/chgrp 명령

  - 파일의 소유권을 바꾸는 명령어

  - ex) # chown ubuntu.ubuntu sample.txt

    \# chown ubuntu sample.txt

    \# chgrp ubuntu sample.txt

  - : 과 . 둘다 사용 가능

  - 사용자만 지정해주면 그 사용자와 맞는 그룹으로 자동 지정해준다.

- 링크

  ![](https://t1.daumcdn.net/cfile/tistory/2374E137516D185813)

  - 하드 링크(hard link)
    - 하드 링크 파일만 하나 생성되며 같은 inode1 사용
    - 명령 : # ln 링크대상파일이름 링크파일이름
  - 심볼릭 링크(symbolic link, soft link)
    - 새로운 inode2를 만들고, 데이터는 원본 파일을 연결하는 효과
    - 명령 : # ln -s 링크대상파일이름 링크파일이름
  - inode : 한 파일이나 디렉토리의 모든 정보를 갖고 있는 64byte로 구성된 표

![](./image/2.JPG)

